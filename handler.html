
<html>
    <head>
        <title>Coverage Report</title>
        
        <style type="text/css">
            body { background-color: #fff; }
            table {
                margin-left: 10px;
                border-collapse: collapse;
            }
            td { 
                background-color: #fff; 
                padding: 2px;
            }
            table.overview td {
                padding-right: 20px;
            }
            td.percent, td.linecount { text-align: right; }
            div.package, #totalcov { 
                color: #fff;
                background-color: #375eab; 
                font-size: 16px;
                font-weight: bold;
                padding: 10px;
                border-radius: 5px 5px 5px 5px;
            }
            div.package, #totalcov { 
                float: right; 
                right: 10px;
            }
            #totalcov { 
                top: 10px;
                position: relative;
                background-color: #fff;
                color: #000;
                border: 1px solid #375eab;
                clear: both;
            }
            #summaryWrapper {
                position: fixed;
                top: 10px;
                float: right;
                right: 10px;

            }
            span.packageTotal {
                float: right;
                color: #000;
            }
            #doctitle { 
                background-color: #fff; 
                font-size: 24px;
                margin-top: 20px;
                margin-left: 10px;
                color: #375eab;
                font-weight: bold;
            }
            #about {
                margin-left: 18px;
                font-size: 10px;
            }
            table tr:last-child td {
                font-weight: bold;
            }
            .functitle, .funcname { 
                text-align: center; 
                font-size: 20px; 
                font-weight: bold; 
                color: 375eab; 
            }
            .funcname {
                text-align: left;
                margin-top: 20px;
                margin-left: 10px;
                margin-bottom: 20px;
                padding: 2px 5px 5px;
                background-color: #e0ebf5;
            }
            table.listing {
                margin-left: 10px;
            }
            table.listing td {
                padding: 0px;
                font-size: 12px;
                background-color: #eee; 
                vertical-align: top;
                padding-left: 10px;
                border-bottom: 1px solid #fff;
            }
            table.listing td:first-child {
                text-align: right;
                font-weight: bold;
                vertical-align: center;
            }
            table.listing tr.miss td {
                background-color: #FFBBB8;
            }
            table.listing tr:last-child td {
                font-weight: normal;
                color: #000;
            }
            table.listing tr:last-child td:first-child {
                font-weight: bold;
            }
            .info {
                margin-left: 10px;
            }
            .info code {
            }
            pre { margin: 1px; }
            pre.cmd { 
                background-color: #e9e9e9;
                border-radius: 5px 5px 5px 5px;
                padding: 10px;
                margin: 20px;
                line-height: 18px;
                font-size; 14px;
            }
            a { 
                text-decoration: none; 
                color: #375eab;
            }
            a:hover { text-decoration: underline; }
            p { margin-left: 10px; }
        </style>
        
    </head>
    <body>
        <div id="doctitle">Coverage Report</div>
    <div id="about">Generated on 18 Dec 15 13:18 +0000 with <a href="https://github.com/matm/gocov-html">gocov-html</a></div><div id="pkg_github.com/TF2Stadium/Helen/controllers/socket/internal/handler" class="funcname">Package Overview: github.com/TF2Stadium/Helen/controllers/socket/internal/handler <span class="packageTotal">29.59%</span></div><p>This is a coverage report created after analysis of the <code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler</code> package. It 
        has been generated with the following command:</p><pre class="cmd">gocov test github.com/TF2Stadium/Helen/controllers/socket/internal/handler | gocov-html</pre>        <p>Here are the stats. Please select a function name to view its implementation and see what's left for testing.</p><table class="overview">
<tr id="s_fn_InitializeBans"><td><code><a href="#fn_InitializeBans">InitializeBans(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/ban.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>4/4</code></td></tr>
<tr id="s_fn_Global.GetSocketInfo"><td><code><a href="#fn_Global.GetSocketInfo">Global.GetSocketInfo(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/global.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>2/2</code></td></tr>
<tr id="s_fn_Global.Name"><td><code><a href="#fn_Global.Name">Global.Name(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/global.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_Admin.Name"><td><code><a href="#fn_Admin.Name">Admin.Name(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/admin.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_Lobby.Name"><td><code><a href="#fn_Lobby.Name">Lobby.Name(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_Player.Name"><td><code><a href="#fn_Player.Name">Player.Name(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/player.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_Chat.Name"><td><code><a href="#fn_Chat.Name">Chat.Name(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/chat.go</code></td><td class="percent"><code>100.00%</code></td><td class="linecount"><code>1/1</code></td></tr>
<tr id="s_fn_Chat.ChatSend"><td><code><a href="#fn_Chat.ChatSend">Chat.ChatSend(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/chat.go</code></td><td class="percent"><code>73.53%</code></td><td class="linecount"><code>25/34</code></td></tr>
<tr id="s_fn_Lobby.LobbyClose"><td><code><a href="#fn_Lobby.LobbyClose">Lobby.LobbyClose(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code></td><td class="percent"><code>72.22%</code></td><td class="linecount"><code>13/18</code></td></tr>
<tr id="s_fn_Lobby.LobbyCreate"><td><code><a href="#fn_Lobby.LobbyCreate">Lobby.LobbyCreate(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code></td><td class="percent"><code>71.05%</code></td><td class="linecount"><code>27/38</code></td></tr>
<tr id="s_fn_Lobby.LobbyLeave"><td><code><a href="#fn_Lobby.LobbyLeave">Lobby.LobbyLeave(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code></td><td class="percent"><code>66.67%</code></td><td class="linecount"><code>8/12</code></td></tr>
<tr id="s_fn_Lobby.LobbySpectatorLeave"><td><code><a href="#fn_Lobby.LobbySpectatorLeave">Lobby.LobbySpectatorLeave(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code></td><td class="percent"><code>61.90%</code></td><td class="linecount"><code>13/21</code></td></tr>
<tr id="s_fn_Lobby.LobbySpectatorJoin"><td><code><a href="#fn_Lobby.LobbySpectatorJoin">Lobby.LobbySpectatorJoin(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code></td><td class="percent"><code>60.00%</code></td><td class="linecount"><code>18/30</code></td></tr>
<tr id="s_fn_Lobby.LobbyJoin"><td><code><a href="#fn_Lobby.LobbyJoin">Lobby.LobbyJoin(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code></td><td class="percent"><code>52.17%</code></td><td class="linecount"><code>24/46</code></td></tr>
<tr id="s_fn_removePlayerFromLobby"><td><code><a href="#fn_removePlayerFromLobby">removePlayerFromLobby(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code></td><td class="percent"><code>40.00%</code></td><td class="linecount"><code>6/15</code></td></tr>
<tr id="s_fn_Player.PlayerReady"><td><code><a href="#fn_Player.PlayerReady">Player.PlayerReady(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/player.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/24</code></td></tr>
<tr id="s_fn_Admin.AdminChangeRole"><td><code><a href="#fn_Admin.AdminChangeRole">Admin.AdminChangeRole(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/admin.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/22</code></td></tr>
<tr id="s_fn_Player.PlayerNotReady"><td><code><a href="#fn_Player.PlayerNotReady">Player.PlayerNotReady(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/player.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/20</code></td></tr>
<tr id="s_fn_Lobby.LobbyBan"><td><code><a href="#fn_Lobby.LobbyBan">Lobby.LobbyBan(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/19</code></td></tr>
<tr id="s_fn_Lobby.LobbyServerReset"><td><code><a href="#fn_Lobby.LobbyServerReset">Lobby.LobbyServerReset(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/19</code></td></tr>
<tr id="s_fn_Lobby.ServerVerify"><td><code><a href="#fn_Lobby.ServerVerify">Lobby.ServerVerify(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/19</code></td></tr>
<tr id="s_fn_Player.PlayerSettingsGet"><td><code><a href="#fn_Player.PlayerSettingsGet">Player.PlayerSettingsGet(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/player.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/18</code></td></tr>
<tr id="s_fn_Lobby.LobbyKick"><td><code><a href="#fn_Lobby.LobbyKick">Lobby.LobbyKick(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/18</code></td></tr>
<tr id="s_fn_Player.PlayerProfile"><td><code><a href="#fn_Player.PlayerProfile">Player.PlayerProfile(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/player.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/15</code></td></tr>
<tr id="s_fn_@314:6"><td><code><a href="#fn_@314:6">@314:6(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/14</code></td></tr>
<tr id="s_fn_newBan"><td><code><a href="#fn_newBan">newBan(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/ban.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/14</code></td></tr>
<tr id="s_fn_Player.PlayerSettingsSet"><td><code><a href="#fn_Player.PlayerSettingsSet">Player.PlayerSettingsSet(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/player.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/12</code></td></tr>
<tr id="s_fn_@64:28"><td><code><a href="#fn_@64:28">@64:28(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/ban.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/11</code></td></tr>
<tr id="s_fn_@90:33"><td><code><a href="#fn_@90:33">@90:33(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/ban.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/10</code></td></tr>
<tr id="s_fn_playerCanKick"><td><code><a href="#fn_playerCanKick">playerCanKick(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/9</code></td></tr>
<tr id="s_fn_Global.GetConstant"><td><code><a href="#fn_Global.GetConstant">Global.GetConstant(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/global.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/8</code></td></tr>
<tr id="s_fn_unban"><td><code><a href="#fn_unban">unban(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/ban.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/7</code></td></tr>
<tr id="s_fn_Lobby.RequestLobbyListData"><td><code><a href="#fn_Lobby.RequestLobbyListData">Lobby.RequestLobbyListData(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/4</code></td></tr>
<tr id="s_fn_FakeResponseWriter.Write"><td><code><a href="#fn_FakeResponseWriter.Write">FakeResponseWriter.Write(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/admin.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_FakeResponseWriter.Header"><td><code><a href="#fn_FakeResponseWriter.Header">FakeResponseWriter.Header(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/admin.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/1</code></td></tr>
<tr id="s_fn_FakeResponseWriter.WriteHeader"><td><code><a href="#fn_FakeResponseWriter.WriteHeader">FakeResponseWriter.WriteHeader(...)</a></code></td><td><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler/admin.go</code></td><td class="percent"><code>0.00%</code></td><td class="linecount"><code>0/0</code></td></tr>
<tr><td colspan="2"><code>github.com/TF2Stadium/Helen/controllers/socket/internal/handler</code></td><td class="percent"><code>29.59%</code></td><td class="linecount"><code>145/490</code></td></tr>
</table>

<div class="funcname" id="fn_InitializeBans">func InitializeBans</div><div class="info"><a href="#s_fn_InitializeBans">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/ban.go</code>:</p></div><table class="listing">
<tr><td>52</td><td><code><pre>func InitializeBans(server *wsevent.Server) {</pre></code></td></tr><tr><td>53</td><td><code><pre>        bans := []struct {</pre></code></td></tr><tr><td>54</td><td><code><pre>                eventName string</pre></code></td></tr><tr><td>55</td><td><code><pre>                action    authority.AuthAction</pre></code></td></tr><tr><td>56</td><td><code><pre>                banType   models.PlayerBanType</pre></code></td></tr><tr><td>57</td><td><code><pre>        }{</pre></code></td></tr><tr><td>58</td><td><code><pre>                {&#34;banJoin&#34;, helpers.ActionBanJoin, models.PlayerBanJoin},</pre></code></td></tr><tr><td>59</td><td><code><pre>                {&#34;banCreate&#34;, helpers.ActionBanCreate, models.PlayerBanCreate},</pre></code></td></tr><tr><td>60</td><td><code><pre>                {&#34;banChat&#34;, helpers.ActionBanChat, models.PlayerBanChat},</pre></code></td></tr><tr><td>61</td><td><code><pre>        }</pre></code></td></tr><tr><td>62</td><td><code><pre></pre></code></td></tr><tr><td>63</td><td><code><pre>        for _, ban := range bans {</pre></code></td></tr><tr><td>64</td><td><code><pre>                server.On(ban.eventName, func(_ *wsevent.Server, so *wsevent.Client, data []byte) interface{} {</pre></code></td></tr><tr><td>65</td><td><code><pre>                        reqerr := chelpers.FilterRequest(so, ban.action, true)</pre></code></td></tr><tr><td>66</td><td><code><pre>                        if reqerr != nil {</pre></code></td></tr><tr><td>67</td><td><code><pre>                                return reqerr</pre></code></td></tr><tr><td>68</td><td><code><pre>                        }</pre></code></td></tr><tr><td>69</td><td><code><pre></pre></code></td></tr><tr><td>70</td><td><code><pre>                        var args struct {</pre></code></td></tr><tr><td>71</td><td><code><pre>                                SteamID *string `json:&#34;steamid&#34;`</pre></code></td></tr><tr><td>72</td><td><code><pre>                                Until   *int64  `json:&#34;until&#34;`</pre></code></td></tr><tr><td>73</td><td><code><pre>                                Reason  *string `json:&#34;reason&#34;`</pre></code></td></tr><tr><td>74</td><td><code><pre>                        }</pre></code></td></tr><tr><td>75</td><td><code><pre></pre></code></td></tr><tr><td>76</td><td><code><pre>                        if err := chelpers.GetParams(data, &amp;args); err != nil {</pre></code></td></tr><tr><td>77</td><td><code><pre>                                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>78</td><td><code><pre>                        }</pre></code></td></tr><tr><td>79</td><td><code><pre></pre></code></td></tr><tr><td>80</td><td><code><pre>                        steamID := chelpers.GetSteamId(so.Id())</pre></code></td></tr><tr><td>81</td><td><code><pre></pre></code></td></tr><tr><td>82</td><td><code><pre>                        tperr := newBan(*args.SteamID, steamID, ban.action, ban.banType, *args.Until, *args.Reason)</pre></code></td></tr><tr><td>83</td><td><code><pre>                        if tperr != nil {</pre></code></td></tr><tr><td>84</td><td><code><pre>                                return tperr</pre></code></td></tr><tr><td>85</td><td><code><pre>                        }</pre></code></td></tr><tr><td>86</td><td><code><pre></pre></code></td></tr><tr><td>87</td><td><code><pre>                        return chelpers.EmptySuccessJS</pre></code></td></tr><tr><td>88</td><td><code><pre>                })</pre></code></td></tr><tr><td>89</td><td><code><pre></pre></code></td></tr><tr><td>90</td><td><code><pre>                server.On(&#34;Un&#34;+ban.eventName, func(_ *wsevent.Server, so *wsevent.Client, data []byte) interface{} {</pre></code></td></tr><tr><td>91</td><td><code><pre>                        reqerr := chelpers.FilterRequest(so, ban.action, true)</pre></code></td></tr><tr><td>92</td><td><code><pre>                        if reqerr != nil {</pre></code></td></tr><tr><td>93</td><td><code><pre>                                return reqerr</pre></code></td></tr><tr><td>94</td><td><code><pre>                        }</pre></code></td></tr><tr><td>95</td><td><code><pre></pre></code></td></tr><tr><td>96</td><td><code><pre>                        var args struct {</pre></code></td></tr><tr><td>97</td><td><code><pre>                                SteamID *string `json:&#34;steamid&#34;`</pre></code></td></tr><tr><td>98</td><td><code><pre>                        }</pre></code></td></tr><tr><td>99</td><td><code><pre></pre></code></td></tr><tr><td>100</td><td><code><pre>                        if err := chelpers.GetParams(data, &amp;args); err != nil {</pre></code></td></tr><tr><td>101</td><td><code><pre>                                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>102</td><td><code><pre>                        }</pre></code></td></tr><tr><td>103</td><td><code><pre></pre></code></td></tr><tr><td>104</td><td><code><pre>                        err := unban(*args.SteamID, ban.banType)</pre></code></td></tr><tr><td>105</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr><td>106</td><td><code><pre>                                return err</pre></code></td></tr><tr><td>107</td><td><code><pre>                        }</pre></code></td></tr><tr><td>108</td><td><code><pre>                        return chelpers.EmptySuccessJS</pre></code></td></tr><tr><td>109</td><td><code><pre>                })</pre></code></td></tr><tr><td>110</td><td><code><pre>        }</pre></code></td></tr><tr><td>111</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Global.GetSocketInfo">func Global.GetSocketInfo</div><div class="info"><a href="#s_fn_Global.GetSocketInfo">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/global.go</code>:</p></div><table class="listing">
<tr><td>40</td><td><code><pre>func (Global) GetSocketInfo(server *wsevent.Server, so *wsevent.Client, data []byte) interface{} {</pre></code></td></tr><tr><td>41</td><td><code><pre>        socketinfo := struct {</pre></code></td></tr><tr><td>42</td><td><code><pre>                ID    string   `json:&#34;id&#34;`</pre></code></td></tr><tr><td>43</td><td><code><pre>                Rooms []string `json:&#34;rooms&#34;`</pre></code></td></tr><tr><td>44</td><td><code><pre>        }{so.Id(), server.RoomsJoined(so.Id())}</pre></code></td></tr><tr><td>45</td><td><code><pre></pre></code></td></tr><tr><td>46</td><td><code><pre>        return chelpers.BuildSuccessJSON(socketinfo)</pre></code></td></tr><tr><td>47</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Global.Name">func Global.Name</div><div class="info"><a href="#s_fn_Global.Name">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/global.go</code>:</p></div><table class="listing">
<tr><td>17</td><td><code><pre>func (Global) Name(s string) string {</pre></code></td></tr><tr><td>18</td><td><code><pre>        return string((s[0])+32) + s[1:]</pre></code></td></tr><tr><td>19</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Admin.Name">func Admin.Name</div><div class="info"><a href="#s_fn_Admin.Name">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/admin.go</code>:</p></div><table class="listing">
<tr><td>29</td><td><code><pre>func (Admin) Name(s string) string {</pre></code></td></tr><tr><td>30</td><td><code><pre>        return string((s[0])+32) + s[1:]</pre></code></td></tr><tr><td>31</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Lobby.Name">func Lobby.Name</div><div class="info"><a href="#s_fn_Lobby.Name">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code>:</p></div><table class="listing">
<tr><td>26</td><td><code><pre>func (Lobby) Name(s string) string {</pre></code></td></tr><tr><td>27</td><td><code><pre>        return string((s[0])+32) + s[1:]</pre></code></td></tr><tr><td>28</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Player.Name">func Player.Name</div><div class="info"><a href="#s_fn_Player.Name">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/player.go</code>:</p></div><table class="listing">
<tr><td>14</td><td><code><pre>func (Player) Name(s string) string {</pre></code></td></tr><tr><td>15</td><td><code><pre>        return string((s[0])+32) + s[1:]</pre></code></td></tr><tr><td>16</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Chat.Name">func Chat.Name</div><div class="info"><a href="#s_fn_Chat.Name">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/chat.go</code>:</p></div><table class="listing">
<tr><td>24</td><td><code><pre>func (Chat) Name(s string) string {</pre></code></td></tr><tr><td>25</td><td><code><pre>        return string((s[0])+32) + s[1:]</pre></code></td></tr><tr><td>26</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Chat.ChatSend">func Chat.ChatSend</div><div class="info"><a href="#s_fn_Chat.ChatSend">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/chat.go</code>:</p></div><table class="listing">
<tr><td>30</td><td><code><pre>func (Chat) ChatSend(server *wsevent.Server, so *wsevent.Client, data []byte) interface{} {</pre></code></td></tr><tr><td>31</td><td><code><pre>        reqerr := chelpers.FilterRequest(so, 0, true)</pre></code></td></tr><tr><td>32</td><td><code><pre></pre></code></td></tr><tr><td>33</td><td><code><pre>        if reqerr != nil {</pre></code></td></tr><tr class="miss"><td>34</td><td><code><pre>                return reqerr</pre></code></td></tr><tr><td>35</td><td><code><pre>        }</pre></code></td></tr><tr><td>36</td><td><code><pre></pre></code></td></tr><tr><td>37</td><td><code><pre>        steamid := chelpers.GetSteamId(so.Id())</pre></code></td></tr><tr><td>38</td><td><code><pre>        now := time.Now().Unix()</pre></code></td></tr><tr><td>39</td><td><code><pre>        if now-lastChatTime[steamid] == 0 {</pre></code></td></tr><tr class="miss"><td>40</td><td><code><pre>                return helpers.NewTPError(&#34;You&#39;re sending messages too quickly&#34;, -1)</pre></code></td></tr><tr><td>41</td><td><code><pre>        }</pre></code></td></tr><tr><td>42</td><td><code><pre></pre></code></td></tr><tr><td>43</td><td><code><pre>        player, tperr := models.GetPlayerBySteamId(steamid)</pre></code></td></tr><tr><td>44</td><td><code><pre></pre></code></td></tr><tr><td>45</td><td><code><pre>        var args struct {</pre></code></td></tr><tr><td>46</td><td><code><pre>                Message *string `json:&#34;message&#34;`</pre></code></td></tr><tr><td>47</td><td><code><pre>                Room    *int    `json:&#34;room&#34;`</pre></code></td></tr><tr><td>48</td><td><code><pre>        }</pre></code></td></tr><tr><td>49</td><td><code><pre></pre></code></td></tr><tr><td>50</td><td><code><pre>        err := chelpers.GetParams(data, &amp;args)</pre></code></td></tr><tr><td>51</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>52</td><td><code><pre>                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>53</td><td><code><pre>        }</pre></code></td></tr><tr><td>54</td><td><code><pre></pre></code></td></tr><tr><td>55</td><td><code><pre>        lastChatTime[steamid] = now</pre></code></td></tr><tr><td>56</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>57</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>58</td><td><code><pre>        }</pre></code></td></tr><tr><td>59</td><td><code><pre></pre></code></td></tr><tr><td>60</td><td><code><pre>        //helpers.Logger.Debug(&#34;received chat message: %s %s&#34;, *args.Message, player.Name)</pre></code></td></tr><tr><td>61</td><td><code><pre></pre></code></td></tr><tr><td>62</td><td><code><pre>        if *args.Room &gt; 0 {</pre></code></td></tr><tr><td>63</td><td><code><pre>                var count int</pre></code></td></tr><tr><td>64</td><td><code><pre>                spec := player.IsSpectatingId(uint(*args.Room))</pre></code></td></tr><tr><td>65</td><td><code><pre>                //Check if player has either joined, or is spectating lobby</pre></code></td></tr><tr><td>66</td><td><code><pre>                db.DB.Table(&#34;lobby_slots&#34;).Where(&#34;lobby_id = ? AND player_id = ?&#34;, *args.Room, player.ID).Count(&amp;count)</pre></code></td></tr><tr><td>67</td><td><code><pre></pre></code></td></tr><tr><td>68</td><td><code><pre>                if !spec &amp;&amp; count == 0 {</pre></code></td></tr><tr class="miss"><td>69</td><td><code><pre>                        return helpers.NewTPError(&#34;Player is not in the lobby.&#34;, 5)</pre></code></td></tr><tr><td>70</td><td><code><pre>                }</pre></code></td></tr><tr><td>71</td><td><code><pre>        } else {</pre></code></td></tr><tr><td>72</td><td><code><pre>                // else room is the lobby list room</pre></code></td></tr><tr><td>73</td><td><code><pre>                *args.Room, _ = strconv.Atoi(config.Constants.GlobalChatRoom)</pre></code></td></tr><tr><td>74</td><td><code><pre>        }</pre></code></td></tr><tr><td>75</td><td><code><pre>        if (*args.Message)[0] == &#39;\n&#39; {</pre></code></td></tr><tr class="miss"><td>76</td><td><code><pre>                return helpers.NewTPError(&#34;Cannot send messages prefixed with newline&#34;, 4)</pre></code></td></tr><tr><td>77</td><td><code><pre>        }</pre></code></td></tr><tr><td>78</td><td><code><pre></pre></code></td></tr><tr><td>79</td><td><code><pre>        if len(*args.Message) &gt; 120 {</pre></code></td></tr><tr class="miss"><td>80</td><td><code><pre>                return helpers.NewTPError(&#34;Message too long&#34;, 4)</pre></code></td></tr><tr><td>81</td><td><code><pre>        }</pre></code></td></tr><tr><td>82</td><td><code><pre></pre></code></td></tr><tr><td>83</td><td><code><pre>        message := models.NewChatMessage(*args.Message, *args.Room, player)</pre></code></td></tr><tr><td>84</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>85</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>86</td><td><code><pre>        }</pre></code></td></tr><tr><td>87</td><td><code><pre>        db.DB.Save(message)</pre></code></td></tr><tr><td>88</td><td><code><pre>        broadcaster.SendMessageToRoom(fmt.Sprintf(&#34;%s_public&#34;,</pre></code></td></tr><tr><td>89</td><td><code><pre>                chelpers.GetLobbyRoom(uint(*args.Room))),</pre></code></td></tr><tr><td>90</td><td><code><pre>                &#34;chatReceive&#34;, message)</pre></code></td></tr><tr><td>91</td><td><code><pre></pre></code></td></tr><tr><td>92</td><td><code><pre>        if strings.HasPrefix(*args.Message, &#34;!admin&#34;) {</pre></code></td></tr><tr class="miss"><td>93</td><td><code><pre>                chelpers.SendToSlack(*args.Message, player.Name, player.SteamId)</pre></code></td></tr><tr><td>94</td><td><code><pre>        }</pre></code></td></tr><tr><td>95</td><td><code><pre></pre></code></td></tr><tr><td>96</td><td><code><pre>        return chelpers.EmptySuccessJS</pre></code></td></tr><tr><td>97</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Lobby.LobbyClose">func Lobby.LobbyClose</div><div class="info"><a href="#s_fn_Lobby.LobbyClose">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code>:</p></div><table class="listing">
<tr><td>204</td><td><code><pre>func (Lobby) LobbyClose(server *wsevent.Server, so *wsevent.Client, data []byte) interface{} {</pre></code></td></tr><tr><td>205</td><td><code><pre>        reqerr := chelpers.FilterRequest(so, authority.AuthAction(0), true)</pre></code></td></tr><tr><td>206</td><td><code><pre></pre></code></td></tr><tr><td>207</td><td><code><pre>        if reqerr != nil {</pre></code></td></tr><tr class="miss"><td>208</td><td><code><pre>                return reqerr</pre></code></td></tr><tr><td>209</td><td><code><pre>        }</pre></code></td></tr><tr><td>210</td><td><code><pre></pre></code></td></tr><tr><td>211</td><td><code><pre>        var args struct {</pre></code></td></tr><tr><td>212</td><td><code><pre>                Id *uint `json:&#34;id&#34;`</pre></code></td></tr><tr><td>213</td><td><code><pre>        }</pre></code></td></tr><tr><td>214</td><td><code><pre></pre></code></td></tr><tr><td>215</td><td><code><pre>        if err := chelpers.GetParams(data, &amp;args); err != nil {</pre></code></td></tr><tr class="miss"><td>216</td><td><code><pre>                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>217</td><td><code><pre></pre></code></td></tr><tr><td>218</td><td><code><pre>        }</pre></code></td></tr><tr><td>219</td><td><code><pre></pre></code></td></tr><tr><td>220</td><td><code><pre>        player, _ := models.GetPlayerBySteamId(chelpers.GetSteamId(so.Id()))</pre></code></td></tr><tr><td>221</td><td><code><pre></pre></code></td></tr><tr><td>222</td><td><code><pre>        lob, tperr := models.GetLobbyByIdServer(uint(*args.Id))</pre></code></td></tr><tr><td>223</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>224</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>225</td><td><code><pre>        }</pre></code></td></tr><tr><td>226</td><td><code><pre></pre></code></td></tr><tr><td>227</td><td><code><pre>        if player.SteamId != lob.CreatedBySteamID &amp;&amp; player.Role != helpers.RoleAdmin {</pre></code></td></tr><tr class="miss"><td>228</td><td><code><pre>                return helpers.NewTPError(&#34;Player not authorized to close lobby.&#34;, -1)</pre></code></td></tr><tr><td>229</td><td><code><pre></pre></code></td></tr><tr><td>230</td><td><code><pre>        }</pre></code></td></tr><tr><td>231</td><td><code><pre></pre></code></td></tr><tr><td>232</td><td><code><pre>        if lob.State == models.LobbyStateEnded {</pre></code></td></tr><tr class="miss"><td>233</td><td><code><pre>                return helpers.NewTPError(&#34;Lobby already closed.&#34;, -1)</pre></code></td></tr><tr><td>234</td><td><code><pre>        }</pre></code></td></tr><tr><td>235</td><td><code><pre></pre></code></td></tr><tr><td>236</td><td><code><pre>        models.FumbleLobbyEnded(lob)</pre></code></td></tr><tr><td>237</td><td><code><pre></pre></code></td></tr><tr><td>238</td><td><code><pre>        lob.Close(true)</pre></code></td></tr><tr><td>239</td><td><code><pre>        models.BroadcastLobbyList() // has to be done manually for now</pre></code></td></tr><tr><td>240</td><td><code><pre></pre></code></td></tr><tr><td>241</td><td><code><pre>        return chelpers.EmptySuccessJS</pre></code></td></tr><tr><td>242</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Lobby.LobbyCreate">func Lobby.LobbyCreate</div><div class="info"><a href="#s_fn_Lobby.LobbyCreate">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code>:</p></div><table class="listing">
<tr><td>30</td><td><code><pre>func (Lobby) LobbyCreate(_ *wsevent.Server, so *wsevent.Client, data []byte) interface{} {</pre></code></td></tr><tr><td>31</td><td><code><pre>        reqerr := chelpers.FilterRequest(so, authority.AuthAction(0), true)</pre></code></td></tr><tr><td>32</td><td><code><pre></pre></code></td></tr><tr><td>33</td><td><code><pre>        if reqerr != nil {</pre></code></td></tr><tr class="miss"><td>34</td><td><code><pre>                return reqerr</pre></code></td></tr><tr><td>35</td><td><code><pre>        }</pre></code></td></tr><tr><td>36</td><td><code><pre></pre></code></td></tr><tr><td>37</td><td><code><pre>        player, _ := models.GetPlayerBySteamId(chelpers.GetSteamId(so.Id()))</pre></code></td></tr><tr><td>38</td><td><code><pre>        if banned, until := player.IsBannedWithTime(models.PlayerBanCreate); banned {</pre></code></td></tr><tr class="miss"><td>39</td><td><code><pre>                str := fmt.Sprintf(&#34;You&#39;ve been banned from creating lobbies till %s&#34;, until.Format(time.RFC822))</pre></code></td></tr><tr class="miss"><td>40</td><td><code><pre>                return helpers.NewTPError(str, -1)</pre></code></td></tr><tr><td>41</td><td><code><pre>        }</pre></code></td></tr><tr><td>42</td><td><code><pre></pre></code></td></tr><tr><td>43</td><td><code><pre>        var args struct {</pre></code></td></tr><tr><td>44</td><td><code><pre>                Map         *string `json:&#34;map&#34;`</pre></code></td></tr><tr><td>45</td><td><code><pre>                Type        *string `json:&#34;type&#34; valid:&#34;debug,6s,highlander,4v4,ultiduo,bball&#34;`</pre></code></td></tr><tr><td>46</td><td><code><pre>                League      *string `json:&#34;league&#34; valid:&#34;ugc,etf2l,esea,asiafortress,ozfortress&#34;`</pre></code></td></tr><tr><td>47</td><td><code><pre>                Server      *string `json:&#34;server&#34;`</pre></code></td></tr><tr><td>48</td><td><code><pre>                RconPwd     *string `json:&#34;rconpwd&#34;`</pre></code></td></tr><tr><td>49</td><td><code><pre>                WhitelistID *uint   `json:&#34;whitelistID&#34;`</pre></code></td></tr><tr><td>50</td><td><code><pre>                Mumble      *bool   `json:&#34;mumbleRequired&#34;`</pre></code></td></tr><tr><td>51</td><td><code><pre>        }</pre></code></td></tr><tr><td>52</td><td><code><pre></pre></code></td></tr><tr><td>53</td><td><code><pre>        err := chelpers.GetParams(data, &amp;args)</pre></code></td></tr><tr><td>54</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>55</td><td><code><pre>                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>56</td><td><code><pre>        }</pre></code></td></tr><tr><td>57</td><td><code><pre></pre></code></td></tr><tr><td>58</td><td><code><pre>        var playermap = map[string]models.LobbyType{</pre></code></td></tr><tr><td>59</td><td><code><pre>                &#34;debug&#34;:      models.LobbyTypeDebug,</pre></code></td></tr><tr><td>60</td><td><code><pre>                &#34;6s&#34;:         models.LobbyTypeSixes,</pre></code></td></tr><tr><td>61</td><td><code><pre>                &#34;highlander&#34;: models.LobbyTypeHighlander,</pre></code></td></tr><tr><td>62</td><td><code><pre>                &#34;ultiduo&#34;:    models.LobbyTypeUltiduo,</pre></code></td></tr><tr><td>63</td><td><code><pre>                &#34;bball&#34;:      models.LobbyTypeBball,</pre></code></td></tr><tr><td>64</td><td><code><pre>                &#34;4v4&#34;:        models.LobbyTypeFours,</pre></code></td></tr><tr><td>65</td><td><code><pre>        }</pre></code></td></tr><tr><td>66</td><td><code><pre></pre></code></td></tr><tr><td>67</td><td><code><pre>        lobbyType := playermap[*args.Type]</pre></code></td></tr><tr><td>68</td><td><code><pre></pre></code></td></tr><tr><td>69</td><td><code><pre>        var count int</pre></code></td></tr><tr><td>70</td><td><code><pre>        db.DB.Table(&#34;server_records&#34;).Where(&#34;host = ?&#34;, *args.Server).Count(&amp;count)</pre></code></td></tr><tr><td>71</td><td><code><pre>        if count != 0 {</pre></code></td></tr><tr class="miss"><td>72</td><td><code><pre>                return helpers.NewTPError(&#34;A lobby is already using this server.&#34;, -1)</pre></code></td></tr><tr><td>73</td><td><code><pre>        }</pre></code></td></tr><tr><td>74</td><td><code><pre></pre></code></td></tr><tr><td>75</td><td><code><pre>        randBytes := make([]byte, 6)</pre></code></td></tr><tr><td>76</td><td><code><pre>        rand.Read(randBytes)</pre></code></td></tr><tr><td>77</td><td><code><pre>        serverPwd := base64.URLEncoding.EncodeToString(randBytes)</pre></code></td></tr><tr><td>78</td><td><code><pre></pre></code></td></tr><tr><td>79</td><td><code><pre>        //TODO what if playermap[lobbytype] is nil?</pre></code></td></tr><tr><td>80</td><td><code><pre>        info := models.ServerRecord{</pre></code></td></tr><tr><td>81</td><td><code><pre>                Host:           *args.Server,</pre></code></td></tr><tr><td>82</td><td><code><pre>                RconPassword:   *args.RconPwd,</pre></code></td></tr><tr><td>83</td><td><code><pre>                ServerPassword: serverPwd}</pre></code></td></tr><tr><td>84</td><td><code><pre>        // err = models.VerifyInfo(info)</pre></code></td></tr><tr><td>85</td><td><code><pre>        // if err != nil {</pre></code></td></tr><tr><td>86</td><td><code><pre>        //         bytes, _ := helpers.NewTPErrorFromError(err).Encode()</pre></code></td></tr><tr><td>87</td><td><code><pre>        //         return string(bytes)</pre></code></td></tr><tr><td>88</td><td><code><pre>        // }</pre></code></td></tr><tr><td>89</td><td><code><pre></pre></code></td></tr><tr><td>90</td><td><code><pre>        lob := models.NewLobby(*args.Map, lobbyType, *args.League, info, int(*args.WhitelistID), *args.Mumble)</pre></code></td></tr><tr><td>91</td><td><code><pre>        lob.CreatedBySteamID = player.SteamId</pre></code></td></tr><tr><td>92</td><td><code><pre>        lob.RegionCode, lob.RegionName = chelpers.GetRegion(*args.Server)</pre></code></td></tr><tr><td>93</td><td><code><pre>        if (lob.RegionCode == &#34;&#34; || lob.RegionName == &#34;&#34;) &amp;&amp; config.Constants.GeoIP != &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>94</td><td><code><pre>                return helpers.NewTPError(&#34;Couldn&#39;t find region server.&#34;, 1)</pre></code></td></tr><tr><td>95</td><td><code><pre>        }</pre></code></td></tr><tr><td>96</td><td><code><pre>        lob.Save()</pre></code></td></tr><tr><td>97</td><td><code><pre></pre></code></td></tr><tr><td>98</td><td><code><pre>        err = lob.SetupServer()</pre></code></td></tr><tr><td>99</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>100</td><td><code><pre>                qerr := db.DB.Where(&#34;id = ?&#34;, lob.ID).Delete(&amp;models.Lobby{}).Error</pre></code></td></tr><tr class="miss"><td>101</td><td><code><pre>                if qerr != nil {</pre></code></td></tr><tr class="miss"><td>102</td><td><code><pre>                        helpers.Logger.Warning(qerr.Error())</pre></code></td></tr><tr><td>103</td><td><code><pre>                }</pre></code></td></tr><tr class="miss"><td>104</td><td><code><pre>                db.DB.Delete(&amp;lob.ServerInfo)</pre></code></td></tr><tr class="miss"><td>105</td><td><code><pre>                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>106</td><td><code><pre>        }</pre></code></td></tr><tr><td>107</td><td><code><pre></pre></code></td></tr><tr><td>108</td><td><code><pre>        lob.State = models.LobbyStateWaiting</pre></code></td></tr><tr><td>109</td><td><code><pre>        lob.Save()</pre></code></td></tr><tr><td>110</td><td><code><pre></pre></code></td></tr><tr><td>111</td><td><code><pre>        models.FumbleLobbyCreated(lob)</pre></code></td></tr><tr><td>112</td><td><code><pre></pre></code></td></tr><tr><td>113</td><td><code><pre>        return chelpers.BuildSuccessJSON(</pre></code></td></tr><tr><td>114</td><td><code><pre>                struct {</pre></code></td></tr><tr><td>115</td><td><code><pre>                        ID uint `json:&#34;id&#34;`</pre></code></td></tr><tr><td>116</td><td><code><pre>                }{lob.ID})</pre></code></td></tr><tr><td>117</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Lobby.LobbyLeave">func Lobby.LobbyLeave</div><div class="info"><a href="#s_fn_Lobby.LobbyLeave">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code>:</p></div><table class="listing">
<tr><td>549</td><td><code><pre>func (Lobby) LobbyLeave(server *wsevent.Server, so *wsevent.Client, data []byte) interface{} {</pre></code></td></tr><tr><td>550</td><td><code><pre>        reqerr := chelpers.FilterRequest(so, authority.AuthAction(0), true)</pre></code></td></tr><tr><td>551</td><td><code><pre></pre></code></td></tr><tr><td>552</td><td><code><pre>        if reqerr != nil {</pre></code></td></tr><tr class="miss"><td>553</td><td><code><pre>                return reqerr</pre></code></td></tr><tr><td>554</td><td><code><pre>        }</pre></code></td></tr><tr><td>555</td><td><code><pre></pre></code></td></tr><tr><td>556</td><td><code><pre>        var args struct {</pre></code></td></tr><tr><td>557</td><td><code><pre>                Id *uint `json:&#34;id&#34;`</pre></code></td></tr><tr><td>558</td><td><code><pre>        }</pre></code></td></tr><tr><td>559</td><td><code><pre>        if err := chelpers.GetParams(data, &amp;args); err != nil {</pre></code></td></tr><tr class="miss"><td>560</td><td><code><pre>                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>561</td><td><code><pre>        }</pre></code></td></tr><tr><td>562</td><td><code><pre></pre></code></td></tr><tr><td>563</td><td><code><pre>        steamId := chelpers.GetSteamId(so.Id())</pre></code></td></tr><tr><td>564</td><td><code><pre></pre></code></td></tr><tr><td>565</td><td><code><pre>        lob, player, tperr := removePlayerFromLobby(*args.Id, steamId)</pre></code></td></tr><tr><td>566</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr><td>567</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>568</td><td><code><pre>        }</pre></code></td></tr><tr><td>569</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>570</td><td><code><pre>        chelpers.AfterLobbyLeave(server, so, lob, player)</pre></code></td></tr><tr><td>571</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>572</td><td><code><pre>        return chelpers.EmptySuccessJS</pre></code></td></tr><tr><td>573</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Lobby.LobbySpectatorLeave">func Lobby.LobbySpectatorLeave</div><div class="info"><a href="#s_fn_Lobby.LobbySpectatorLeave">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code>:</p></div><table class="listing">
<tr><td>575</td><td><code><pre>func (Lobby) LobbySpectatorLeave(server *wsevent.Server, so *wsevent.Client, data []byte) interface{} {</pre></code></td></tr><tr><td>576</td><td><code><pre>        reqerr := chelpers.FilterRequest(so, authority.AuthAction(0), true)</pre></code></td></tr><tr><td>577</td><td><code><pre></pre></code></td></tr><tr><td>578</td><td><code><pre>        if reqerr != nil {</pre></code></td></tr><tr class="miss"><td>579</td><td><code><pre>                return reqerr</pre></code></td></tr><tr><td>580</td><td><code><pre>        }</pre></code></td></tr><tr><td>581</td><td><code><pre></pre></code></td></tr><tr><td>582</td><td><code><pre>        var args struct {</pre></code></td></tr><tr><td>583</td><td><code><pre>                Id *uint `json:&#34;id&#34;`</pre></code></td></tr><tr><td>584</td><td><code><pre>        }</pre></code></td></tr><tr><td>585</td><td><code><pre>        if err := chelpers.GetParams(data, &amp;args); err != nil {</pre></code></td></tr><tr class="miss"><td>586</td><td><code><pre>                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>587</td><td><code><pre>        }</pre></code></td></tr><tr><td>588</td><td><code><pre></pre></code></td></tr><tr><td>589</td><td><code><pre>        steamId := chelpers.GetSteamId(so.Id())</pre></code></td></tr><tr><td>590</td><td><code><pre>        player, tperr := models.GetPlayerBySteamId(steamId)</pre></code></td></tr><tr><td>591</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>592</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>593</td><td><code><pre>        }</pre></code></td></tr><tr><td>594</td><td><code><pre></pre></code></td></tr><tr><td>595</td><td><code><pre>        lob, tperr := models.GetLobbyById(*args.Id)</pre></code></td></tr><tr><td>596</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>597</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>598</td><td><code><pre>        }</pre></code></td></tr><tr><td>599</td><td><code><pre></pre></code></td></tr><tr><td>600</td><td><code><pre>        if !player.IsSpectatingId(lob.ID) {</pre></code></td></tr><tr class="miss"><td>601</td><td><code><pre>                if id, _ := player.GetLobbyId(); id == *args.Id {</pre></code></td></tr><tr class="miss"><td>602</td><td><code><pre>                        chelpers.AfterLobbySpecLeave(server, so, lob)</pre></code></td></tr><tr class="miss"><td>603</td><td><code><pre>                        return chelpers.EmptySuccessJS</pre></code></td></tr><tr><td>604</td><td><code><pre>                }</pre></code></td></tr><tr><td>605</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>606</td><td><code><pre>                return helpers.NewTPError(&#34;Player is not spectating&#34;, -1)</pre></code></td></tr><tr><td>607</td><td><code><pre>        }</pre></code></td></tr><tr><td>608</td><td><code><pre></pre></code></td></tr><tr><td>609</td><td><code><pre>        lob.RemoveSpectator(player, true)</pre></code></td></tr><tr><td>610</td><td><code><pre>        chelpers.AfterLobbySpecLeave(server, so, lob)</pre></code></td></tr><tr><td>611</td><td><code><pre></pre></code></td></tr><tr><td>612</td><td><code><pre>        return chelpers.EmptySuccessJS</pre></code></td></tr><tr><td>613</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Lobby.LobbySpectatorJoin">func Lobby.LobbySpectatorJoin</div><div class="info"><a href="#s_fn_Lobby.LobbySpectatorJoin">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code>:</p></div><table class="listing">
<tr><td>362</td><td><code><pre>func (Lobby) LobbySpectatorJoin(server *wsevent.Server, so *wsevent.Client, data []byte) interface{} {</pre></code></td></tr><tr><td>363</td><td><code><pre>        reqerr := chelpers.FilterRequest(so, authority.AuthAction(0), true)</pre></code></td></tr><tr><td>364</td><td><code><pre></pre></code></td></tr><tr><td>365</td><td><code><pre>        if reqerr != nil {</pre></code></td></tr><tr class="miss"><td>366</td><td><code><pre>                return reqerr</pre></code></td></tr><tr><td>367</td><td><code><pre>        }</pre></code></td></tr><tr><td>368</td><td><code><pre></pre></code></td></tr><tr><td>369</td><td><code><pre>        var args struct {</pre></code></td></tr><tr><td>370</td><td><code><pre>                Id *uint `json:&#34;id&#34;`</pre></code></td></tr><tr><td>371</td><td><code><pre>        }</pre></code></td></tr><tr><td>372</td><td><code><pre></pre></code></td></tr><tr><td>373</td><td><code><pre>        if err := chelpers.GetParams(data, &amp;args); err != nil {</pre></code></td></tr><tr class="miss"><td>374</td><td><code><pre>                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>375</td><td><code><pre>        }</pre></code></td></tr><tr><td>376</td><td><code><pre></pre></code></td></tr><tr><td>377</td><td><code><pre>        var lob *models.Lobby</pre></code></td></tr><tr><td>378</td><td><code><pre>        lob, tperr := models.GetLobbyById(*args.Id)</pre></code></td></tr><tr><td>379</td><td><code><pre></pre></code></td></tr><tr><td>380</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>381</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>382</td><td><code><pre>        }</pre></code></td></tr><tr><td>383</td><td><code><pre></pre></code></td></tr><tr><td>384</td><td><code><pre>        player, tperr := models.GetPlayerBySteamId(chelpers.GetSteamId(so.Id()))</pre></code></td></tr><tr><td>385</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>386</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>387</td><td><code><pre>        }</pre></code></td></tr><tr><td>388</td><td><code><pre></pre></code></td></tr><tr><td>389</td><td><code><pre>        var specSameLobby bool</pre></code></td></tr><tr><td>390</td><td><code><pre></pre></code></td></tr><tr><td>391</td><td><code><pre>        arr, tperr := player.GetSpectatingIds()</pre></code></td></tr><tr><td>392</td><td><code><pre>        if len(arr) != 0 {</pre></code></td></tr><tr class="miss"><td>393</td><td><code><pre>                for _, id := range arr {</pre></code></td></tr><tr class="miss"><td>394</td><td><code><pre>                        if id == *args.Id {</pre></code></td></tr><tr class="miss"><td>395</td><td><code><pre>                                specSameLobby = true</pre></code></td></tr><tr class="miss"><td>396</td><td><code><pre>                                continue</pre></code></td></tr><tr><td>397</td><td><code><pre>                        }</pre></code></td></tr><tr><td>398</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>399</td><td><code><pre>                        lobby, _ := models.GetLobbyById(id)</pre></code></td></tr><tr class="miss"><td>400</td><td><code><pre>                        lobby.RemoveSpectator(player, true)</pre></code></td></tr><tr><td>401</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>402</td><td><code><pre>                        server.RemoveClient(so.Id(), fmt.Sprintf(&#34;%d_public&#34;, id))</pre></code></td></tr><tr><td>403</td><td><code><pre>                }</pre></code></td></tr><tr><td>404</td><td><code><pre>        }</pre></code></td></tr><tr><td>405</td><td><code><pre></pre></code></td></tr><tr><td>406</td><td><code><pre>        // If the player is already in the lobby (either joined a slot or is spectating), don&#39;t add them.</pre></code></td></tr><tr><td>407</td><td><code><pre>        // Just Broadcast the lobby to them, so the frontend displays it.</pre></code></td></tr><tr><td>408</td><td><code><pre>        if id, _ := player.GetLobbyId(); id != *args.Id &amp;&amp; !specSameLobby {</pre></code></td></tr><tr><td>409</td><td><code><pre>                tperr = lob.AddSpectator(player)</pre></code></td></tr><tr><td>410</td><td><code><pre></pre></code></td></tr><tr><td>411</td><td><code><pre>                if tperr != nil {</pre></code></td></tr><tr class="miss"><td>412</td><td><code><pre>                        return tperr</pre></code></td></tr><tr><td>413</td><td><code><pre>                }</pre></code></td></tr><tr><td>414</td><td><code><pre>        }</pre></code></td></tr><tr><td>415</td><td><code><pre></pre></code></td></tr><tr><td>416</td><td><code><pre>        chelpers.AfterLobbySpec(server, so, lob)</pre></code></td></tr><tr><td>417</td><td><code><pre>        models.BroadcastLobbyToUser(lob, player.SteamId)</pre></code></td></tr><tr><td>418</td><td><code><pre>        return chelpers.EmptySuccessJS</pre></code></td></tr><tr><td>419</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Lobby.LobbyJoin">func Lobby.LobbyJoin</div><div class="info"><a href="#s_fn_Lobby.LobbyJoin">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code>:</p></div><table class="listing">
<tr><td>244</td><td><code><pre>func (Lobby) LobbyJoin(server *wsevent.Server, so *wsevent.Client, data []byte) interface{} {</pre></code></td></tr><tr><td>245</td><td><code><pre>        reqerr := chelpers.FilterRequest(so, authority.AuthAction(0), true)</pre></code></td></tr><tr><td>246</td><td><code><pre></pre></code></td></tr><tr><td>247</td><td><code><pre>        if reqerr != nil {</pre></code></td></tr><tr class="miss"><td>248</td><td><code><pre>                return reqerr</pre></code></td></tr><tr><td>249</td><td><code><pre></pre></code></td></tr><tr><td>250</td><td><code><pre>        }</pre></code></td></tr><tr><td>251</td><td><code><pre></pre></code></td></tr><tr><td>252</td><td><code><pre>        player, _ := models.GetPlayerBySteamId(chelpers.GetSteamId(so.Id()))</pre></code></td></tr><tr><td>253</td><td><code><pre>        if banned, until := player.IsBannedWithTime(models.PlayerBanJoin); banned {</pre></code></td></tr><tr class="miss"><td>254</td><td><code><pre>                str := fmt.Sprintf(&#34;You have been banned from joining lobbies till %s&#34;, until.Format(time.RFC822))</pre></code></td></tr><tr class="miss"><td>255</td><td><code><pre>                return helpers.NewTPError(str, -1)</pre></code></td></tr><tr><td>256</td><td><code><pre>        }</pre></code></td></tr><tr><td>257</td><td><code><pre></pre></code></td></tr><tr><td>258</td><td><code><pre>        var args struct {</pre></code></td></tr><tr><td>259</td><td><code><pre>                Id    *uint   `json:&#34;id&#34;`</pre></code></td></tr><tr><td>260</td><td><code><pre>                Class *string `json:&#34;class&#34;`</pre></code></td></tr><tr><td>261</td><td><code><pre>                Team  *string `json:&#34;team&#34; valid:&#34;red,blu&#34;`</pre></code></td></tr><tr><td>262</td><td><code><pre>        }</pre></code></td></tr><tr><td>263</td><td><code><pre></pre></code></td></tr><tr><td>264</td><td><code><pre>        if err := chelpers.GetParams(data, &amp;args); err != nil {</pre></code></td></tr><tr class="miss"><td>265</td><td><code><pre>                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>266</td><td><code><pre>        }</pre></code></td></tr><tr><td>267</td><td><code><pre>        //helpers.Logger.Debug(&#34;id %d class %s team %s&#34;, *args.Id, *args.Class, *args.Team)</pre></code></td></tr><tr><td>268</td><td><code><pre></pre></code></td></tr><tr><td>269</td><td><code><pre>        lob, tperr := models.GetLobbyById(*args.Id)</pre></code></td></tr><tr><td>270</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>271</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>272</td><td><code><pre>        }</pre></code></td></tr><tr><td>273</td><td><code><pre></pre></code></td></tr><tr><td>274</td><td><code><pre>        if lob.State == models.LobbyStateEnded {</pre></code></td></tr><tr><td>275</td><td><code><pre>                return helpers.NewTPError(&#34;Cannot join a closed lobby.&#34;, -1)</pre></code></td></tr><tr><td>276</td><td><code><pre></pre></code></td></tr><tr><td>277</td><td><code><pre>        }</pre></code></td></tr><tr><td>278</td><td><code><pre></pre></code></td></tr><tr><td>279</td><td><code><pre>        //Check if player is in the same lobby</pre></code></td></tr><tr><td>280</td><td><code><pre>        var sameLobby bool</pre></code></td></tr><tr><td>281</td><td><code><pre>        if id, err := player.GetLobbyId(); err == nil &amp;&amp; id == *args.Id {</pre></code></td></tr><tr class="miss"><td>282</td><td><code><pre>                sameLobby = true</pre></code></td></tr><tr><td>283</td><td><code><pre>        }</pre></code></td></tr><tr><td>284</td><td><code><pre></pre></code></td></tr><tr><td>285</td><td><code><pre>        slot, tperr := models.LobbyGetPlayerSlot(lob.Type, *args.Team, *args.Class)</pre></code></td></tr><tr><td>286</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>287</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>288</td><td><code><pre>        }</pre></code></td></tr><tr><td>289</td><td><code><pre></pre></code></td></tr><tr><td>290</td><td><code><pre>        if prevId, _ := player.GetLobbyId(); prevId != 0 &amp;&amp; !sameLobby {</pre></code></td></tr><tr class="miss"><td>291</td><td><code><pre>                server.RemoveClient(so.Id(), fmt.Sprintf(&#34;%d_public&#34;, prevId))</pre></code></td></tr><tr class="miss"><td>292</td><td><code><pre>                server.RemoveClient(so.Id(), fmt.Sprintf(&#34;%d_private&#34;, prevId))</pre></code></td></tr><tr><td>293</td><td><code><pre>        }</pre></code></td></tr><tr><td>294</td><td><code><pre></pre></code></td></tr><tr><td>295</td><td><code><pre>        tperr = lob.AddPlayer(player, slot, *args.Team, *args.Class)</pre></code></td></tr><tr><td>296</td><td><code><pre></pre></code></td></tr><tr><td>297</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>298</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>299</td><td><code><pre>        }</pre></code></td></tr><tr><td>300</td><td><code><pre></pre></code></td></tr><tr><td>301</td><td><code><pre>        if !sameLobby {</pre></code></td></tr><tr><td>302</td><td><code><pre>                chelpers.AfterLobbyJoin(server, so, lob, player)</pre></code></td></tr><tr><td>303</td><td><code><pre>        }</pre></code></td></tr><tr><td>304</td><td><code><pre></pre></code></td></tr><tr><td>305</td><td><code><pre>        if lob.IsFull() {</pre></code></td></tr><tr class="miss"><td>306</td><td><code><pre>                lob.State = models.LobbyStateReadyingUp</pre></code></td></tr><tr class="miss"><td>307</td><td><code><pre>                lob.ReadyUpTimestamp = time.Now().Unix() + 30</pre></code></td></tr><tr class="miss"><td>308</td><td><code><pre>                lob.Save()</pre></code></td></tr><tr><td>309</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>310</td><td><code><pre>                tick := time.After(time.Second * 30)</pre></code></td></tr><tr class="miss"><td>311</td><td><code><pre>                id := lob.ID</pre></code></td></tr><tr class="miss"><td>312</td><td><code><pre>                stop := make(chan struct{})</pre></code></td></tr><tr><td>313</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>314</td><td><code><pre>                go func() {</pre></code></td></tr><tr><td>315</td><td><code><pre>                        select {</pre></code></td></tr><tr><td>316</td><td><code><pre>                        case &lt;-tick:</pre></code></td></tr><tr><td>317</td><td><code><pre>                                lobby := &amp;models.Lobby{}</pre></code></td></tr><tr><td>318</td><td><code><pre>                                db.DB.First(lobby, id)</pre></code></td></tr><tr><td>319</td><td><code><pre></pre></code></td></tr><tr><td>320</td><td><code><pre>                                if lobby.State != models.LobbyStateInProgress {</pre></code></td></tr><tr><td>321</td><td><code><pre>                                        err := lobby.RemoveUnreadyPlayers()</pre></code></td></tr><tr><td>322</td><td><code><pre>                                        if err != nil {</pre></code></td></tr><tr><td>323</td><td><code><pre>                                                helpers.Logger.Error(&#34;RemoveUnreadyPlayers: &#34;, err.Error())</pre></code></td></tr><tr><td>324</td><td><code><pre>                                                err = nil</pre></code></td></tr><tr><td>325</td><td><code><pre>                                        }</pre></code></td></tr><tr><td>326</td><td><code><pre></pre></code></td></tr><tr><td>327</td><td><code><pre>                                        err = lobby.UnreadyAllPlayers()</pre></code></td></tr><tr><td>328</td><td><code><pre>                                        if err != nil {</pre></code></td></tr><tr><td>329</td><td><code><pre>                                                helpers.Logger.Error(&#34;UnreadyAllPlayers: &#34;, err.Error())</pre></code></td></tr><tr><td>330</td><td><code><pre>                                        }</pre></code></td></tr><tr><td>331</td><td><code><pre></pre></code></td></tr><tr><td>332</td><td><code><pre>                                        lobby.State = models.LobbyStateWaiting</pre></code></td></tr><tr><td>333</td><td><code><pre>                                        lobby.Save()</pre></code></td></tr><tr><td>334</td><td><code><pre>                                }</pre></code></td></tr><tr><td>335</td><td><code><pre></pre></code></td></tr><tr><td>336</td><td><code><pre>                        case &lt;-stop:</pre></code></td></tr><tr><td>337</td><td><code><pre>                                return</pre></code></td></tr><tr><td>338</td><td><code><pre>                        }</pre></code></td></tr><tr><td>339</td><td><code><pre>                }()</pre></code></td></tr><tr><td>340</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>341</td><td><code><pre>                room := fmt.Sprintf(&#34;%s_private&#34;,</pre></code></td></tr><tr><td>342</td><td><code><pre>                        chelpers.GetLobbyRoom(lob.ID))</pre></code></td></tr><tr class="miss"><td>343</td><td><code><pre>                broadcaster.SendMessageToRoom(room, &#34;lobbyReadyUp&#34;,</pre></code></td></tr><tr><td>344</td><td><code><pre>                        struct {</pre></code></td></tr><tr><td>345</td><td><code><pre>                                Timeout int `json:&#34;timeout&#34;`</pre></code></td></tr><tr><td>346</td><td><code><pre>                        }{30})</pre></code></td></tr><tr class="miss"><td>347</td><td><code><pre>                models.BroadcastLobbyList()</pre></code></td></tr><tr><td>348</td><td><code><pre>        }</pre></code></td></tr><tr><td>349</td><td><code><pre></pre></code></td></tr><tr><td>350</td><td><code><pre>        err := models.AllowPlayer(*args.Id, player.SteamId, *args.Team+*args.Class)</pre></code></td></tr><tr><td>351</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>352</td><td><code><pre>                helpers.Logger.Error(err.Error())</pre></code></td></tr><tr><td>353</td><td><code><pre>        }</pre></code></td></tr><tr><td>354</td><td><code><pre></pre></code></td></tr><tr><td>355</td><td><code><pre>        if lob.State == models.LobbyStateInProgress {</pre></code></td></tr><tr class="miss"><td>356</td><td><code><pre>                broadcaster.SendMessage(player.SteamId, &#34;lobbyStart&#34;, models.DecorateLobbyConnect(lob, player.Name, *args.Class))</pre></code></td></tr><tr><td>357</td><td><code><pre>        }</pre></code></td></tr><tr><td>358</td><td><code><pre></pre></code></td></tr><tr><td>359</td><td><code><pre>        return chelpers.EmptySuccessJS</pre></code></td></tr><tr><td>360</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_removePlayerFromLobby">func removePlayerFromLobby</div><div class="info"><a href="#s_fn_removePlayerFromLobby">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code>:</p></div><table class="listing">
<tr><td>421</td><td><code><pre>func removePlayerFromLobby(lobbyId uint, steamId string) (*models.Lobby, *models.Player, *helpers.TPError) {</pre></code></td></tr><tr><td>422</td><td><code><pre>        player, tperr := models.GetPlayerBySteamId(steamId)</pre></code></td></tr><tr><td>423</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>424</td><td><code><pre>                return nil, nil, tperr</pre></code></td></tr><tr><td>425</td><td><code><pre>        }</pre></code></td></tr><tr><td>426</td><td><code><pre></pre></code></td></tr><tr><td>427</td><td><code><pre>        lob, tperr := models.GetLobbyById(lobbyId)</pre></code></td></tr><tr><td>428</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>429</td><td><code><pre>                return nil, nil, tperr</pre></code></td></tr><tr><td>430</td><td><code><pre>        }</pre></code></td></tr><tr><td>431</td><td><code><pre></pre></code></td></tr><tr><td>432</td><td><code><pre>        switch lob.State {</pre></code></td></tr><tr><td>433</td><td><code><pre>        case models.LobbyStateInProgress:</pre></code></td></tr><tr class="miss"><td>434</td><td><code><pre>                return lob, player, helpers.NewTPError(&#34;Lobby is in progress.&#34;, 1)</pre></code></td></tr><tr><td>435</td><td><code><pre>        case models.LobbyStateEnded:</pre></code></td></tr><tr><td>436</td><td><code><pre>                return lob, player, helpers.NewTPError(&#34;Lobby has closed.&#34;, 1)</pre></code></td></tr><tr><td>437</td><td><code><pre>        }</pre></code></td></tr><tr><td>438</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>439</td><td><code><pre>        _, err := lob.GetPlayerSlot(player)</pre></code></td></tr><tr class="miss"><td>440</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>441</td><td><code><pre>                return lob, player, helpers.NewTPError(&#34;Player not playing&#34;, 2)</pre></code></td></tr><tr><td>442</td><td><code><pre>        }</pre></code></td></tr><tr><td>443</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>444</td><td><code><pre>        if err := lob.RemovePlayer(player); err != nil {</pre></code></td></tr><tr class="miss"><td>445</td><td><code><pre>                return lob, player, err</pre></code></td></tr><tr><td>446</td><td><code><pre>        }</pre></code></td></tr><tr><td>447</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>448</td><td><code><pre>        return lob, player, lob.AddSpectator(player)</pre></code></td></tr><tr><td>449</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Player.PlayerReady">func Player.PlayerReady</div><div class="info"><a href="#s_fn_Player.PlayerReady">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/player.go</code>:</p></div><table class="listing">
<tr><td>18</td><td><code><pre>func (Player) PlayerReady(_ *wsevent.Server, so *wsevent.Client, data []byte) interface{} {</pre></code></td></tr><tr class="miss"><td>19</td><td><code><pre>        reqerr := chelpers.FilterRequest(so, authority.AuthAction(0), true)</pre></code></td></tr><tr><td>20</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>21</td><td><code><pre>        if reqerr != nil {</pre></code></td></tr><tr class="miss"><td>22</td><td><code><pre>                return reqerr</pre></code></td></tr><tr><td>23</td><td><code><pre>        }</pre></code></td></tr><tr><td>24</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>25</td><td><code><pre>        steamid := chelpers.GetSteamId(so.Id())</pre></code></td></tr><tr class="miss"><td>26</td><td><code><pre>        player, tperr := models.GetPlayerBySteamId(steamid)</pre></code></td></tr><tr class="miss"><td>27</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>28</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>29</td><td><code><pre>        }</pre></code></td></tr><tr><td>30</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>31</td><td><code><pre>        lobbyid, tperr := player.GetLobbyId()</pre></code></td></tr><tr class="miss"><td>32</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>33</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>34</td><td><code><pre>        }</pre></code></td></tr><tr><td>35</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>36</td><td><code><pre>        lobby, tperr := models.GetLobbyByIdServer(lobbyid)</pre></code></td></tr><tr class="miss"><td>37</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>38</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>39</td><td><code><pre>        }</pre></code></td></tr><tr><td>40</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>41</td><td><code><pre>        if lobby.State != models.LobbyStateReadyingUp {</pre></code></td></tr><tr class="miss"><td>42</td><td><code><pre>                return helpers.NewTPError(&#34;Lobby hasn&#39;t been filled up yet.&#34;, 4)</pre></code></td></tr><tr><td>43</td><td><code><pre>        }</pre></code></td></tr><tr><td>44</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>45</td><td><code><pre>        tperr = lobby.ReadyPlayer(player)</pre></code></td></tr><tr><td>46</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>47</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>48</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>49</td><td><code><pre>        }</pre></code></td></tr><tr><td>50</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>51</td><td><code><pre>        if lobby.IsEveryoneReady() {</pre></code></td></tr><tr class="miss"><td>52</td><td><code><pre>                db.DB.Table(&#34;lobbies&#34;).Where(&#34;id = ?&#34;, lobby.ID).Update(&#34;state&#34;, models.LobbyStateInProgress)</pre></code></td></tr><tr><td>53</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>54</td><td><code><pre>                chelpers.BroadcastLobbyStart(lobby)</pre></code></td></tr><tr class="miss"><td>55</td><td><code><pre>                models.BroadcastLobbyList()</pre></code></td></tr><tr class="miss"><td>56</td><td><code><pre>                models.FumbleLobbyStarted(lobby)</pre></code></td></tr><tr><td>57</td><td><code><pre>        }</pre></code></td></tr><tr><td>58</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>59</td><td><code><pre>        return chelpers.EmptySuccessJS</pre></code></td></tr><tr><td>60</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Admin.AdminChangeRole">func Admin.AdminChangeRole</div><div class="info"><a href="#s_fn_Admin.AdminChangeRole">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/admin.go</code>:</p></div><table class="listing">
<tr><td>33</td><td><code><pre>func (Admin) AdminChangeRole(server *wsevent.Server, so *wsevent.Client, data []byte) interface{} {</pre></code></td></tr><tr class="miss"><td>34</td><td><code><pre>        reqerr := chelpers.FilterRequest(so, 0, true)</pre></code></td></tr><tr><td>35</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>36</td><td><code><pre>        if reqerr != nil {</pre></code></td></tr><tr class="miss"><td>37</td><td><code><pre>                return reqerr</pre></code></td></tr><tr><td>38</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>39</td><td><code><pre>        var args struct {</pre></code></td></tr><tr><td>40</td><td><code><pre>                Steamid *string `json:&#34;steamid&#34;`</pre></code></td></tr><tr><td>41</td><td><code><pre>                Role    *string `json:&#34;role&#34;`</pre></code></td></tr><tr><td>42</td><td><code><pre>        }</pre></code></td></tr><tr><td>43</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>44</td><td><code><pre>        err := chelpers.GetParams(data, &amp;args)</pre></code></td></tr><tr class="miss"><td>45</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>46</td><td><code><pre>                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>47</td><td><code><pre>        }</pre></code></td></tr><tr><td>48</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>49</td><td><code><pre>        role, ok := helpers.RoleMap[*args.Role]</pre></code></td></tr><tr class="miss"><td>50</td><td><code><pre>        if !ok || role == helpers.RoleAdmin {</pre></code></td></tr><tr class="miss"><td>51</td><td><code><pre>                return helpers.NewTPError(&#34;Invalid role parameter&#34;, 0)</pre></code></td></tr><tr><td>52</td><td><code><pre>        }</pre></code></td></tr><tr><td>53</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>54</td><td><code><pre>        otherPlayer, tperr := models.GetPlayerBySteamId(*args.Steamid)</pre></code></td></tr><tr class="miss"><td>55</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>56</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>57</td><td><code><pre>        }</pre></code></td></tr><tr><td>58</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>59</td><td><code><pre>        currPlayer, _ := chelpers.GetPlayerSocket(so.Id())</pre></code></td></tr><tr><td>60</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>61</td><td><code><pre>        models.LogAdminAction(currPlayer.ID, helpers.ActionChangeRole, otherPlayer.ID)</pre></code></td></tr><tr><td>62</td><td><code><pre></pre></code></td></tr><tr><td>63</td><td><code><pre>        // actual change happens</pre></code></td></tr><tr class="miss"><td>64</td><td><code><pre>        otherPlayer.Role = role</pre></code></td></tr><tr class="miss"><td>65</td><td><code><pre>        db.DB.Save(&amp;otherPlayer)</pre></code></td></tr><tr><td>66</td><td><code><pre></pre></code></td></tr><tr><td>67</td><td><code><pre>        // rewrite session data. THIS WON&#39;T WRITE A COOKIE SO IT ONLY WORKS WITH</pre></code></td></tr><tr><td>68</td><td><code><pre>        // STORES THAT STORE DATA IN COOKIES (AND NOT ONLY SESSION ID).</pre></code></td></tr><tr class="miss"><td>69</td><td><code><pre>        session, sesserr := chelpers.GetSessionHTTP(so.Request())</pre></code></td></tr><tr class="miss"><td>70</td><td><code><pre>        if sesserr == nil {</pre></code></td></tr><tr class="miss"><td>71</td><td><code><pre>                session.Values[&#34;role&#34;] = role</pre></code></td></tr><tr class="miss"><td>72</td><td><code><pre>                session.Save(so.Request(), FakeResponseWriter{})</pre></code></td></tr><tr><td>73</td><td><code><pre>        }</pre></code></td></tr><tr><td>74</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>75</td><td><code><pre>        return chelpers.EmptySuccessJS</pre></code></td></tr><tr><td>76</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Player.PlayerNotReady">func Player.PlayerNotReady</div><div class="info"><a href="#s_fn_Player.PlayerNotReady">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/player.go</code>:</p></div><table class="listing">
<tr><td>62</td><td><code><pre>func (Player) PlayerNotReady(_ *wsevent.Server, so *wsevent.Client, data []byte) interface{} {</pre></code></td></tr><tr class="miss"><td>63</td><td><code><pre>        reqerr := chelpers.FilterRequest(so, authority.AuthAction(0), true)</pre></code></td></tr><tr><td>64</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>65</td><td><code><pre>        if reqerr != nil {</pre></code></td></tr><tr class="miss"><td>66</td><td><code><pre>                return reqerr</pre></code></td></tr><tr><td>67</td><td><code><pre>        }</pre></code></td></tr><tr><td>68</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>69</td><td><code><pre>        player, tperr := models.GetPlayerBySteamId(chelpers.GetSteamId(so.Id()))</pre></code></td></tr><tr><td>70</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>71</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>72</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>73</td><td><code><pre>        }</pre></code></td></tr><tr><td>74</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>75</td><td><code><pre>        lobbyid, tperr := player.GetLobbyId()</pre></code></td></tr><tr class="miss"><td>76</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>77</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>78</td><td><code><pre>        }</pre></code></td></tr><tr><td>79</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>80</td><td><code><pre>        lobby, tperr := models.GetLobbyById(lobbyid)</pre></code></td></tr><tr class="miss"><td>81</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>82</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>83</td><td><code><pre>        }</pre></code></td></tr><tr><td>84</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>85</td><td><code><pre>        if lobby.State != models.LobbyStateReadyingUp {</pre></code></td></tr><tr class="miss"><td>86</td><td><code><pre>                return helpers.NewTPError(&#34;Lobby hasn&#39;t been filled up yet.&#34;, 4)</pre></code></td></tr><tr><td>87</td><td><code><pre>        }</pre></code></td></tr><tr><td>88</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>89</td><td><code><pre>        tperr = lobby.UnreadyPlayer(player)</pre></code></td></tr><tr class="miss"><td>90</td><td><code><pre>        lobby.RemovePlayer(player)</pre></code></td></tr><tr><td>91</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>92</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>93</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>94</td><td><code><pre>        }</pre></code></td></tr><tr><td>95</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>96</td><td><code><pre>        lobby.UnreadyAllPlayers()</pre></code></td></tr><tr class="miss"><td>97</td><td><code><pre>        return chelpers.EmptySuccessJS</pre></code></td></tr><tr><td>98</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Lobby.LobbyBan">func Lobby.LobbyBan</div><div class="info"><a href="#s_fn_Lobby.LobbyBan">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code>:</p></div><table class="listing">
<tr><td>507</td><td><code><pre>func (Lobby) LobbyBan(server *wsevent.Server, so *wsevent.Client, data []byte) interface{} {</pre></code></td></tr><tr class="miss"><td>508</td><td><code><pre>        reqerr := chelpers.FilterRequest(so, authority.AuthAction(0), true)</pre></code></td></tr><tr><td>509</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>510</td><td><code><pre>        if reqerr != nil {</pre></code></td></tr><tr class="miss"><td>511</td><td><code><pre>                return reqerr</pre></code></td></tr><tr><td>512</td><td><code><pre>        }</pre></code></td></tr><tr><td>513</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>514</td><td><code><pre>        var args struct {</pre></code></td></tr><tr><td>515</td><td><code><pre>                Id      *uint   `json:&#34;id&#34;`</pre></code></td></tr><tr><td>516</td><td><code><pre>                Steamid *string `json:&#34;steamid&#34;`</pre></code></td></tr><tr><td>517</td><td><code><pre>        }</pre></code></td></tr><tr><td>518</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>519</td><td><code><pre>        if err := chelpers.GetParams(data, &amp;args); err != nil {</pre></code></td></tr><tr class="miss"><td>520</td><td><code><pre>                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>521</td><td><code><pre>        }</pre></code></td></tr><tr><td>522</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>523</td><td><code><pre>        steamId := *args.Steamid</pre></code></td></tr><tr class="miss"><td>524</td><td><code><pre>        selfSteamId := chelpers.GetSteamId(so.Id())</pre></code></td></tr><tr><td>525</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>526</td><td><code><pre>        if steamId == selfSteamId {</pre></code></td></tr><tr class="miss"><td>527</td><td><code><pre>                return helpers.NewTPError(&#34;Player can&#39;t kick himself.&#34;, -1)</pre></code></td></tr><tr><td>528</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>529</td><td><code><pre>        if ok, tperr := playerCanKick(*args.Id, selfSteamId); !ok {</pre></code></td></tr><tr class="miss"><td>530</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>531</td><td><code><pre>        }</pre></code></td></tr><tr><td>532</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>533</td><td><code><pre>        lob, player, tperr := removePlayerFromLobby(*args.Id, steamId)</pre></code></td></tr><tr class="miss"><td>534</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>535</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>536</td><td><code><pre>        }</pre></code></td></tr><tr><td>537</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>538</td><td><code><pre>        lob.BanPlayer(player)</pre></code></td></tr><tr><td>539</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>540</td><td><code><pre>        so, _ = broadcaster.GetSocket(player.SteamId)</pre></code></td></tr><tr class="miss"><td>541</td><td><code><pre>        chelpers.AfterLobbyLeave(server, so, lob, player)</pre></code></td></tr><tr><td>542</td><td><code><pre></pre></code></td></tr><tr><td>543</td><td><code><pre>        // broadcaster.SendMessage(steamId, &#34;sendNotification&#34;,</pre></code></td></tr><tr><td>544</td><td><code><pre>        //         fmt.Sprintf(`{&#34;notification&#34;: &#34;You have been removed from Lobby #%d&#34;}`, *args.Id))</pre></code></td></tr><tr><td>545</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>546</td><td><code><pre>        return chelpers.EmptySuccessJS</pre></code></td></tr><tr><td>547</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Lobby.LobbyServerReset">func Lobby.LobbyServerReset</div><div class="info"><a href="#s_fn_Lobby.LobbyServerReset">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code>:</p></div><table class="listing">
<tr><td>119</td><td><code><pre>func (Lobby) LobbyServerReset(server *wsevent.Server, so *wsevent.Client, data []byte) interface{} {</pre></code></td></tr><tr class="miss"><td>120</td><td><code><pre>        reqerr := chelpers.FilterRequest(so, authority.AuthAction(0), true)</pre></code></td></tr><tr><td>121</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>122</td><td><code><pre>        if reqerr != nil {</pre></code></td></tr><tr class="miss"><td>123</td><td><code><pre>                return reqerr</pre></code></td></tr><tr><td>124</td><td><code><pre>        }</pre></code></td></tr><tr><td>125</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>126</td><td><code><pre>        var args struct {</pre></code></td></tr><tr><td>127</td><td><code><pre>                ID *uint `json:&#34;id&#34;`</pre></code></td></tr><tr><td>128</td><td><code><pre>        }</pre></code></td></tr><tr><td>129</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>130</td><td><code><pre>        if err := chelpers.GetParams(data, &amp;args); err != nil {</pre></code></td></tr><tr class="miss"><td>131</td><td><code><pre>                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>132</td><td><code><pre>        }</pre></code></td></tr><tr><td>133</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>134</td><td><code><pre>        player, tperr := models.GetPlayerBySteamId(chelpers.GetSteamId(so.Id()))</pre></code></td></tr><tr class="miss"><td>135</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>136</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>137</td><td><code><pre>        }</pre></code></td></tr><tr><td>138</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>139</td><td><code><pre>        lobby, tperr := models.GetLobbyById(*args.ID)</pre></code></td></tr><tr><td>140</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>141</td><td><code><pre>        if player.SteamId != lobby.CreatedBySteamID || player.Role != helpers.RoleAdmin {</pre></code></td></tr><tr class="miss"><td>142</td><td><code><pre>                return helpers.NewTPError(&#34;Player not authorized to reset server.&#34;, -1)</pre></code></td></tr><tr><td>143</td><td><code><pre>        }</pre></code></td></tr><tr><td>144</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>145</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>146</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>147</td><td><code><pre>        }</pre></code></td></tr><tr><td>148</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>149</td><td><code><pre>        if lobby.State == models.LobbyStateEnded {</pre></code></td></tr><tr class="miss"><td>150</td><td><code><pre>                return helpers.NewTPError(&#34;Lobby has ended&#34;, 1)</pre></code></td></tr><tr><td>151</td><td><code><pre>        }</pre></code></td></tr><tr><td>152</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>153</td><td><code><pre>        if err := models.ReExecConfig(lobby.ID); err != nil {</pre></code></td></tr><tr class="miss"><td>154</td><td><code><pre>                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>155</td><td><code><pre>        }</pre></code></td></tr><tr><td>156</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>157</td><td><code><pre>        return chelpers.EmptySuccessJS</pre></code></td></tr><tr><td>158</td><td><code><pre></pre></code></td></tr><tr><td>159</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Lobby.ServerVerify">func Lobby.ServerVerify</div><div class="info"><a href="#s_fn_Lobby.ServerVerify">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code>:</p></div><table class="listing">
<tr><td>163</td><td><code><pre>func (Lobby) ServerVerify(server *wsevent.Server, so *wsevent.Client, data []byte) interface{} {</pre></code></td></tr><tr class="miss"><td>164</td><td><code><pre>        reqerr := chelpers.FilterRequest(so, authority.AuthAction(0), true)</pre></code></td></tr><tr><td>165</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>166</td><td><code><pre>        if reqerr != nil {</pre></code></td></tr><tr class="miss"><td>167</td><td><code><pre>                return reqerr</pre></code></td></tr><tr><td>168</td><td><code><pre>        }</pre></code></td></tr><tr><td>169</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>170</td><td><code><pre>        var args struct {</pre></code></td></tr><tr><td>171</td><td><code><pre>                Server  *string `json:&#34;server&#34;`</pre></code></td></tr><tr><td>172</td><td><code><pre>                Rconpwd *string `json:&#34;rconpwd&#34;`</pre></code></td></tr><tr><td>173</td><td><code><pre>        }</pre></code></td></tr><tr><td>174</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>175</td><td><code><pre>        if err := chelpers.GetParams(data, &amp;args); err != nil {</pre></code></td></tr><tr class="miss"><td>176</td><td><code><pre>                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>177</td><td><code><pre>        }</pre></code></td></tr><tr><td>178</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>179</td><td><code><pre>        if !validAddress.MatchString(*args.Server) {</pre></code></td></tr><tr class="miss"><td>180</td><td><code><pre>                return helpers.NewTPError(&#34;Invalid Server Address&#34;, -1)</pre></code></td></tr><tr><td>181</td><td><code><pre>        }</pre></code></td></tr><tr><td>182</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>183</td><td><code><pre>        var count int</pre></code></td></tr><tr class="miss"><td>184</td><td><code><pre>        db.DB.Table(&#34;server_records&#34;).Where(&#34;host = ?&#34;, *args.Server).Count(&amp;count)</pre></code></td></tr><tr class="miss"><td>185</td><td><code><pre>        if count != 0 {</pre></code></td></tr><tr class="miss"><td>186</td><td><code><pre>                return helpers.NewTPError(&#34;A lobby is already using this server.&#34;, -1)</pre></code></td></tr><tr><td>187</td><td><code><pre>        }</pre></code></td></tr><tr><td>188</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>189</td><td><code><pre>        info := &amp;models.ServerRecord{</pre></code></td></tr><tr><td>190</td><td><code><pre>                Host:         *args.Server,</pre></code></td></tr><tr><td>191</td><td><code><pre>                RconPassword: *args.Rconpwd,</pre></code></td></tr><tr><td>192</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>193</td><td><code><pre>        db.DB.Save(info)</pre></code></td></tr><tr class="miss"><td>194</td><td><code><pre>        defer db.DB.Where(&#34;host = ?&#34;, info.Host).Delete(models.ServerRecord{})</pre></code></td></tr><tr><td>195</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>196</td><td><code><pre>        err := models.VerifyInfo(*info)</pre></code></td></tr><tr class="miss"><td>197</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>198</td><td><code><pre>                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>199</td><td><code><pre>        }</pre></code></td></tr><tr><td>200</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>201</td><td><code><pre>        return chelpers.EmptySuccessJS</pre></code></td></tr><tr><td>202</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Player.PlayerSettingsGet">func Player.PlayerSettingsGet</div><div class="info"><a href="#s_fn_Player.PlayerSettingsGet">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/player.go</code>:</p></div><table class="listing">
<tr><td>100</td><td><code><pre>func (Player) PlayerSettingsGet(server *wsevent.Server, so *wsevent.Client, data []byte) interface{} {</pre></code></td></tr><tr class="miss"><td>101</td><td><code><pre>        reqerr := chelpers.FilterRequest(so, 0, true)</pre></code></td></tr><tr><td>102</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>103</td><td><code><pre>        if reqerr != nil {</pre></code></td></tr><tr class="miss"><td>104</td><td><code><pre>                return reqerr</pre></code></td></tr><tr><td>105</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>106</td><td><code><pre>        var args struct {</pre></code></td></tr><tr><td>107</td><td><code><pre>                Key string `json:&#34;key&#34;`</pre></code></td></tr><tr><td>108</td><td><code><pre>        }</pre></code></td></tr><tr><td>109</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>110</td><td><code><pre>        err := chelpers.GetParams(data, &amp;args)</pre></code></td></tr><tr class="miss"><td>111</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>112</td><td><code><pre>                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>113</td><td><code><pre>        }</pre></code></td></tr><tr><td>114</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>115</td><td><code><pre>        player, _ := models.GetPlayerBySteamId(chelpers.GetSteamId(so.Id()))</pre></code></td></tr><tr><td>116</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>117</td><td><code><pre>        var settings []models.PlayerSetting</pre></code></td></tr><tr class="miss"><td>118</td><td><code><pre>        var setting models.PlayerSetting</pre></code></td></tr><tr class="miss"><td>119</td><td><code><pre>        if args.Key == &#34;*&#34; {</pre></code></td></tr><tr class="miss"><td>120</td><td><code><pre>                settings, err = player.GetSettings()</pre></code></td></tr><tr><td>121</td><td><code><pre>        } else {</pre></code></td></tr><tr class="miss"><td>122</td><td><code><pre>                setting, err = player.GetSetting(args.Key)</pre></code></td></tr><tr class="miss"><td>123</td><td><code><pre>                settings = append(settings, setting)</pre></code></td></tr><tr><td>124</td><td><code><pre>        }</pre></code></td></tr><tr><td>125</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>126</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>127</td><td><code><pre>                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>128</td><td><code><pre>        }</pre></code></td></tr><tr><td>129</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>130</td><td><code><pre>        result := models.DecoratePlayerSettingsJson(settings)</pre></code></td></tr><tr class="miss"><td>131</td><td><code><pre>        return chelpers.BuildSuccessJSON(result)</pre></code></td></tr><tr><td>132</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Lobby.LobbyKick">func Lobby.LobbyKick</div><div class="info"><a href="#s_fn_Lobby.LobbyKick">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code>:</p></div><table class="listing">
<tr><td>467</td><td><code><pre>func (Lobby) LobbyKick(server *wsevent.Server, so *wsevent.Client, data []byte) interface{} {</pre></code></td></tr><tr class="miss"><td>468</td><td><code><pre>        reqerr := chelpers.FilterRequest(so, authority.AuthAction(0), true)</pre></code></td></tr><tr><td>469</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>470</td><td><code><pre>        if reqerr != nil {</pre></code></td></tr><tr class="miss"><td>471</td><td><code><pre>                return reqerr</pre></code></td></tr><tr><td>472</td><td><code><pre>        }</pre></code></td></tr><tr><td>473</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>474</td><td><code><pre>        var args struct {</pre></code></td></tr><tr><td>475</td><td><code><pre>                Id      *uint   `json:&#34;id&#34;`</pre></code></td></tr><tr><td>476</td><td><code><pre>                Steamid *string `json:&#34;steamid&#34;`</pre></code></td></tr><tr><td>477</td><td><code><pre>        }</pre></code></td></tr><tr><td>478</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>479</td><td><code><pre>        if err := chelpers.GetParams(data, &amp;args); err != nil {</pre></code></td></tr><tr class="miss"><td>480</td><td><code><pre>                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>481</td><td><code><pre>        }</pre></code></td></tr><tr><td>482</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>483</td><td><code><pre>        steamId := *args.Steamid</pre></code></td></tr><tr class="miss"><td>484</td><td><code><pre>        selfSteamId := chelpers.GetSteamId(so.Id())</pre></code></td></tr><tr><td>485</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>486</td><td><code><pre>        if steamId == selfSteamId {</pre></code></td></tr><tr class="miss"><td>487</td><td><code><pre>                return helpers.NewTPError(&#34;Player can&#39;t kick himself.&#34;, -1)</pre></code></td></tr><tr><td>488</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>489</td><td><code><pre>        if ok, tperr := playerCanKick(*args.Id, selfSteamId); !ok {</pre></code></td></tr><tr class="miss"><td>490</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>491</td><td><code><pre>        }</pre></code></td></tr><tr><td>492</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>493</td><td><code><pre>        lob, player, tperr := removePlayerFromLobby(*args.Id, steamId)</pre></code></td></tr><tr class="miss"><td>494</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>495</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>496</td><td><code><pre>        }</pre></code></td></tr><tr><td>497</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>498</td><td><code><pre>        so, _ = broadcaster.GetSocket(player.SteamId)</pre></code></td></tr><tr class="miss"><td>499</td><td><code><pre>        chelpers.AfterLobbyLeave(server, so, lob, player)</pre></code></td></tr><tr><td>500</td><td><code><pre></pre></code></td></tr><tr><td>501</td><td><code><pre>        // broadcaster.SendMessage(steamId, &#34;sendNotification&#34;,</pre></code></td></tr><tr><td>502</td><td><code><pre>        //         fmt.Sprintf(`{&#34;notification&#34;: &#34;You have been removed from Lobby #%d&#34;}`, *args.Id))</pre></code></td></tr><tr><td>503</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>504</td><td><code><pre>        return chelpers.EmptySuccessJS</pre></code></td></tr><tr><td>505</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Player.PlayerProfile">func Player.PlayerProfile</div><div class="info"><a href="#s_fn_Player.PlayerProfile">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/player.go</code>:</p></div><table class="listing">
<tr><td>160</td><td><code><pre>func (Player) PlayerProfile(server *wsevent.Server, so *wsevent.Client, data []byte) interface{} {</pre></code></td></tr><tr class="miss"><td>161</td><td><code><pre>        reqerr := chelpers.FilterRequest(so, 0, true)</pre></code></td></tr><tr><td>162</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>163</td><td><code><pre>        if reqerr != nil {</pre></code></td></tr><tr class="miss"><td>164</td><td><code><pre>                return reqerr</pre></code></td></tr><tr><td>165</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>166</td><td><code><pre>        var args struct {</pre></code></td></tr><tr><td>167</td><td><code><pre>                Steamid string `json:&#34;steamid&#34;`</pre></code></td></tr><tr><td>168</td><td><code><pre>        }</pre></code></td></tr><tr><td>169</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>170</td><td><code><pre>        err := chelpers.GetParams(data, &amp;args)</pre></code></td></tr><tr class="miss"><td>171</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>172</td><td><code><pre>                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>173</td><td><code><pre>        }</pre></code></td></tr><tr><td>174</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>175</td><td><code><pre>        steamid := args.Steamid</pre></code></td></tr><tr class="miss"><td>176</td><td><code><pre>        if steamid == &#34;&#34; {</pre></code></td></tr><tr class="miss"><td>177</td><td><code><pre>                steamid = chelpers.GetSteamId(so.Id())</pre></code></td></tr><tr><td>178</td><td><code><pre>        }</pre></code></td></tr><tr><td>179</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>180</td><td><code><pre>        player, playErr := models.GetPlayerWithStats(steamid)</pre></code></td></tr><tr><td>181</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>182</td><td><code><pre>        if playErr != nil {</pre></code></td></tr><tr class="miss"><td>183</td><td><code><pre>                return playErr</pre></code></td></tr><tr><td>184</td><td><code><pre>        }</pre></code></td></tr><tr><td>185</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>186</td><td><code><pre>        result := models.DecoratePlayerProfileJson(player)</pre></code></td></tr><tr class="miss"><td>187</td><td><code><pre>        return chelpers.BuildSuccessJSON(result)</pre></code></td></tr><tr><td>188</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@314:6">func @314:6</div><div class="info"><a href="#s_fn_@314:6">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code>:</p></div><table class="listing">
<tr><td>314</td><td><code><pre>func() {</pre></code></td></tr><tr class="miss"><td>315</td><td><code><pre>                        select {</pre></code></td></tr><tr><td>316</td><td><code><pre>                        case &lt;-tick:</pre></code></td></tr><tr class="miss"><td>317</td><td><code><pre>                                lobby := &amp;models.Lobby{}</pre></code></td></tr><tr class="miss"><td>318</td><td><code><pre>                                db.DB.First(lobby, id)</pre></code></td></tr><tr><td>319</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>320</td><td><code><pre>                                if lobby.State != models.LobbyStateInProgress {</pre></code></td></tr><tr class="miss"><td>321</td><td><code><pre>                                        err := lobby.RemoveUnreadyPlayers()</pre></code></td></tr><tr class="miss"><td>322</td><td><code><pre>                                        if err != nil {</pre></code></td></tr><tr class="miss"><td>323</td><td><code><pre>                                                helpers.Logger.Error(&#34;RemoveUnreadyPlayers: &#34;, err.Error())</pre></code></td></tr><tr class="miss"><td>324</td><td><code><pre>                                                err = nil</pre></code></td></tr><tr><td>325</td><td><code><pre>                                        }</pre></code></td></tr><tr><td>326</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>327</td><td><code><pre>                                        err = lobby.UnreadyAllPlayers()</pre></code></td></tr><tr class="miss"><td>328</td><td><code><pre>                                        if err != nil {</pre></code></td></tr><tr class="miss"><td>329</td><td><code><pre>                                                helpers.Logger.Error(&#34;UnreadyAllPlayers: &#34;, err.Error())</pre></code></td></tr><tr><td>330</td><td><code><pre>                                        }</pre></code></td></tr><tr><td>331</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>332</td><td><code><pre>                                        lobby.State = models.LobbyStateWaiting</pre></code></td></tr><tr class="miss"><td>333</td><td><code><pre>                                        lobby.Save()</pre></code></td></tr><tr><td>334</td><td><code><pre>                                }</pre></code></td></tr><tr><td>335</td><td><code><pre></pre></code></td></tr><tr><td>336</td><td><code><pre>                        case &lt;-stop:</pre></code></td></tr><tr class="miss"><td>337</td><td><code><pre>                                return</pre></code></td></tr><tr><td>338</td><td><code><pre>                        }</pre></code></td></tr><tr><td>339</td><td><code><pre>                }</pre></code></td></tr></table>

<div class="funcname" id="fn_newBan">func newBan</div><div class="info"><a href="#s_fn_newBan">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/ban.go</code>:</p></div><table class="listing">
<tr><td>13</td><td><code><pre>func newBan(player_steamid, admin_steamid string, action authority.AuthAction, bantype models.PlayerBanType, until int64, reason string) *helpers.TPError {</pre></code></td></tr><tr class="miss"><td>14</td><td><code><pre>        player, tperr := models.GetPlayerBySteamId(player_steamid)</pre></code></td></tr><tr class="miss"><td>15</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>16</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>17</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>18</td><td><code><pre>        admin, tperr := models.GetPlayerBySteamId(admin_steamid)</pre></code></td></tr><tr class="miss"><td>19</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>20</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>21</td><td><code><pre>        }</pre></code></td></tr><tr><td>22</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>23</td><td><code><pre>        time := time.Unix(time.Now().Unix()+until, 0)</pre></code></td></tr><tr class="miss"><td>24</td><td><code><pre>        err := player.BanUntil(time, bantype, reason)</pre></code></td></tr><tr><td>25</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>26</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>27</td><td><code><pre>                tperr = helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>28</td><td><code><pre>        }</pre></code></td></tr><tr><td>29</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>30</td><td><code><pre>        err = models.LogAdminAction(admin.ID, action, player.ID)</pre></code></td></tr><tr class="miss"><td>31</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>32</td><td><code><pre>                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>33</td><td><code><pre>        }</pre></code></td></tr><tr><td>34</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>35</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>36</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Player.PlayerSettingsSet">func Player.PlayerSettingsSet</div><div class="info"><a href="#s_fn_Player.PlayerSettingsSet">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/player.go</code>:</p></div><table class="listing">
<tr><td>134</td><td><code><pre>func (Player) PlayerSettingsSet(server *wsevent.Server, so *wsevent.Client, data []byte) interface{} {</pre></code></td></tr><tr class="miss"><td>135</td><td><code><pre>        reqerr := chelpers.FilterRequest(so, 0, true)</pre></code></td></tr><tr><td>136</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>137</td><td><code><pre>        if reqerr != nil {</pre></code></td></tr><tr class="miss"><td>138</td><td><code><pre>                return reqerr</pre></code></td></tr><tr><td>139</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>140</td><td><code><pre>        var args struct {</pre></code></td></tr><tr><td>141</td><td><code><pre>                Key   string `json:&#34;key&#34;`</pre></code></td></tr><tr><td>142</td><td><code><pre>                Value string `json:&#34;value&#34;`</pre></code></td></tr><tr><td>143</td><td><code><pre>        }</pre></code></td></tr><tr><td>144</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>145</td><td><code><pre>        err := chelpers.GetParams(data, &amp;args)</pre></code></td></tr><tr class="miss"><td>146</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>147</td><td><code><pre>                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>148</td><td><code><pre>        }</pre></code></td></tr><tr><td>149</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>150</td><td><code><pre>        player, _ := models.GetPlayerBySteamId(chelpers.GetSteamId(so.Id()))</pre></code></td></tr><tr><td>151</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>152</td><td><code><pre>        err = player.SetSetting(args.Key, args.Value)</pre></code></td></tr><tr class="miss"><td>153</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>154</td><td><code><pre>                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>155</td><td><code><pre>        }</pre></code></td></tr><tr><td>156</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>157</td><td><code><pre>        return chelpers.EmptySuccessJS</pre></code></td></tr><tr><td>158</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_@64:28">func @64:28</div><div class="info"><a href="#s_fn_@64:28">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/ban.go</code>:</p></div><table class="listing">
<tr><td>64</td><td><code><pre>func(_ *wsevent.Server, so *wsevent.Client, data []byte) interface{} {</pre></code></td></tr><tr class="miss"><td>65</td><td><code><pre>                        reqerr := chelpers.FilterRequest(so, ban.action, true)</pre></code></td></tr><tr class="miss"><td>66</td><td><code><pre>                        if reqerr != nil {</pre></code></td></tr><tr class="miss"><td>67</td><td><code><pre>                                return reqerr</pre></code></td></tr><tr><td>68</td><td><code><pre>                        }</pre></code></td></tr><tr><td>69</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>70</td><td><code><pre>                        var args struct {</pre></code></td></tr><tr><td>71</td><td><code><pre>                                SteamID *string `json:&#34;steamid&#34;`</pre></code></td></tr><tr><td>72</td><td><code><pre>                                Until   *int64  `json:&#34;until&#34;`</pre></code></td></tr><tr><td>73</td><td><code><pre>                                Reason  *string `json:&#34;reason&#34;`</pre></code></td></tr><tr><td>74</td><td><code><pre>                        }</pre></code></td></tr><tr><td>75</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>76</td><td><code><pre>                        if err := chelpers.GetParams(data, &amp;args); err != nil {</pre></code></td></tr><tr class="miss"><td>77</td><td><code><pre>                                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>78</td><td><code><pre>                        }</pre></code></td></tr><tr><td>79</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>80</td><td><code><pre>                        steamID := chelpers.GetSteamId(so.Id())</pre></code></td></tr><tr><td>81</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>82</td><td><code><pre>                        tperr := newBan(*args.SteamID, steamID, ban.action, ban.banType, *args.Until, *args.Reason)</pre></code></td></tr><tr class="miss"><td>83</td><td><code><pre>                        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>84</td><td><code><pre>                                return tperr</pre></code></td></tr><tr><td>85</td><td><code><pre>                        }</pre></code></td></tr><tr><td>86</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>87</td><td><code><pre>                        return chelpers.EmptySuccessJS</pre></code></td></tr><tr><td>88</td><td><code><pre>                }</pre></code></td></tr></table>

<div class="funcname" id="fn_@90:33">func @90:33</div><div class="info"><a href="#s_fn_@90:33">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/ban.go</code>:</p></div><table class="listing">
<tr><td>90</td><td><code><pre>func(_ *wsevent.Server, so *wsevent.Client, data []byte) interface{} {</pre></code></td></tr><tr class="miss"><td>91</td><td><code><pre>                        reqerr := chelpers.FilterRequest(so, ban.action, true)</pre></code></td></tr><tr class="miss"><td>92</td><td><code><pre>                        if reqerr != nil {</pre></code></td></tr><tr class="miss"><td>93</td><td><code><pre>                                return reqerr</pre></code></td></tr><tr><td>94</td><td><code><pre>                        }</pre></code></td></tr><tr><td>95</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>96</td><td><code><pre>                        var args struct {</pre></code></td></tr><tr><td>97</td><td><code><pre>                                SteamID *string `json:&#34;steamid&#34;`</pre></code></td></tr><tr><td>98</td><td><code><pre>                        }</pre></code></td></tr><tr><td>99</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>100</td><td><code><pre>                        if err := chelpers.GetParams(data, &amp;args); err != nil {</pre></code></td></tr><tr class="miss"><td>101</td><td><code><pre>                                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>102</td><td><code><pre>                        }</pre></code></td></tr><tr><td>103</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>104</td><td><code><pre>                        err := unban(*args.SteamID, ban.banType)</pre></code></td></tr><tr class="miss"><td>105</td><td><code><pre>                        if err != nil {</pre></code></td></tr><tr class="miss"><td>106</td><td><code><pre>                                return err</pre></code></td></tr><tr><td>107</td><td><code><pre>                        }</pre></code></td></tr><tr class="miss"><td>108</td><td><code><pre>                        return chelpers.EmptySuccessJS</pre></code></td></tr><tr><td>109</td><td><code><pre>                }</pre></code></td></tr></table>

<div class="funcname" id="fn_playerCanKick">func playerCanKick</div><div class="info"><a href="#s_fn_playerCanKick">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code>:</p></div><table class="listing">
<tr><td>451</td><td><code><pre>func playerCanKick(lobbyId uint, steamId string) (bool, *helpers.TPError) {</pre></code></td></tr><tr class="miss"><td>452</td><td><code><pre>        lob, tperr := models.GetLobbyById(lobbyId)</pre></code></td></tr><tr class="miss"><td>453</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>454</td><td><code><pre>                return false, tperr</pre></code></td></tr><tr><td>455</td><td><code><pre>        }</pre></code></td></tr><tr><td>456</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>457</td><td><code><pre>        player, tperr2 := models.GetPlayerBySteamId(steamId)</pre></code></td></tr><tr class="miss"><td>458</td><td><code><pre>        if tperr2 != nil {</pre></code></td></tr><tr class="miss"><td>459</td><td><code><pre>                return false, tperr2</pre></code></td></tr><tr><td>460</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>461</td><td><code><pre>        if steamId != lob.CreatedBySteamID &amp;&amp; player.Role != helpers.RoleAdmin {</pre></code></td></tr><tr class="miss"><td>462</td><td><code><pre>                return false, helpers.NewTPError(&#34;Not authorized to kick players&#34;, 1)</pre></code></td></tr><tr><td>463</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>464</td><td><code><pre>        return true, nil</pre></code></td></tr><tr><td>465</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Global.GetConstant">func Global.GetConstant</div><div class="info"><a href="#s_fn_Global.GetConstant">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/global.go</code>:</p></div><table class="listing">
<tr><td>21</td><td><code><pre>func (Global) GetConstant(_ *wsevent.Server, so *wsevent.Client, data []byte) interface{} {</pre></code></td></tr><tr class="miss"><td>22</td><td><code><pre>        var args struct {</pre></code></td></tr><tr><td>23</td><td><code><pre>                Constant string `json:&#34;constant&#34;`</pre></code></td></tr><tr><td>24</td><td><code><pre>        }</pre></code></td></tr><tr class="miss"><td>25</td><td><code><pre>        if err := chelpers.GetParams(data, &amp;args); err != nil {</pre></code></td></tr><tr class="miss"><td>26</td><td><code><pre>                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>27</td><td><code><pre>        }</pre></code></td></tr><tr><td>28</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>29</td><td><code><pre>        output := simplejson.New()</pre></code></td></tr><tr class="miss"><td>30</td><td><code><pre>        switch args.Constant {</pre></code></td></tr><tr><td>31</td><td><code><pre>        case &#34;lobbySettingsList&#34;:</pre></code></td></tr><tr class="miss"><td>32</td><td><code><pre>                output = models.LobbySettingsToJson()</pre></code></td></tr><tr><td>33</td><td><code><pre>        default:</pre></code></td></tr><tr class="miss"><td>34</td><td><code><pre>                return helpers.NewTPError(&#34;Unknown constant.&#34;, -1)</pre></code></td></tr><tr><td>35</td><td><code><pre>        }</pre></code></td></tr><tr><td>36</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>37</td><td><code><pre>        return chelpers.BuildSuccessJSON(output)</pre></code></td></tr><tr><td>38</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_unban">func unban</div><div class="info"><a href="#s_fn_unban">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/ban.go</code>:</p></div><table class="listing">
<tr><td>38</td><td><code><pre>func unban(steamid string, bantype models.PlayerBanType) *helpers.TPError {</pre></code></td></tr><tr class="miss"><td>39</td><td><code><pre>        player, tperr := models.GetPlayerBySteamId(steamid)</pre></code></td></tr><tr class="miss"><td>40</td><td><code><pre>        if tperr != nil {</pre></code></td></tr><tr class="miss"><td>41</td><td><code><pre>                return tperr</pre></code></td></tr><tr><td>42</td><td><code><pre>        }</pre></code></td></tr><tr><td>43</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>44</td><td><code><pre>        err := player.Unban(bantype)</pre></code></td></tr><tr class="miss"><td>45</td><td><code><pre>        if err != nil {</pre></code></td></tr><tr class="miss"><td>46</td><td><code><pre>                return helpers.NewTPErrorFromError(err)</pre></code></td></tr><tr><td>47</td><td><code><pre>        }</pre></code></td></tr><tr><td>48</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>49</td><td><code><pre>        return nil</pre></code></td></tr><tr><td>50</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_Lobby.RequestLobbyListData">func Lobby.RequestLobbyListData</div><div class="info"><a href="#s_fn_Lobby.RequestLobbyListData">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/lobby.go</code>:</p></div><table class="listing">
<tr><td>615</td><td><code><pre>func (Lobby) RequestLobbyListData(_ *wsevent.Server, so *wsevent.Client, data []byte) interface{} {</pre></code></td></tr><tr class="miss"><td>616</td><td><code><pre>        var lobbies []models.Lobby</pre></code></td></tr><tr class="miss"><td>617</td><td><code><pre>        db.DB.Where(&#34;state = ?&#34;, models.LobbyStateWaiting).Order(&#34;id desc&#34;).Find(&amp;lobbies)</pre></code></td></tr><tr class="miss"><td>618</td><td><code><pre>        so.EmitJSON(helpers.NewRequest(&#34;lobbyListData&#34;, models.DecorateLobbyListData(lobbies)))</pre></code></td></tr><tr><td>619</td><td><code><pre></pre></code></td></tr><tr class="miss"><td>620</td><td><code><pre>        return chelpers.EmptySuccessJS</pre></code></td></tr><tr><td>621</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_FakeResponseWriter.Write">func FakeResponseWriter.Write</div><div class="info"><a href="#s_fn_FakeResponseWriter.Write">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/admin.go</code>:</p></div><table class="listing">
<tr><td>22</td><td><code><pre>func (f FakeResponseWriter) Write(b []byte) (int, error) {</pre></code></td></tr><tr class="miss"><td>23</td><td><code><pre>        return 0, nil</pre></code></td></tr><tr><td>24</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_FakeResponseWriter.Header">func FakeResponseWriter.Header</div><div class="info"><a href="#s_fn_FakeResponseWriter.Header">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/admin.go</code>:</p></div><table class="listing">
<tr><td>19</td><td><code><pre>func (f FakeResponseWriter) Header() http.Header {</pre></code></td></tr><tr class="miss"><td>20</td><td><code><pre>        return http.Header{}</pre></code></td></tr><tr><td>21</td><td><code><pre>}</pre></code></td></tr></table>

<div class="funcname" id="fn_FakeResponseWriter.WriteHeader">func FakeResponseWriter.WriteHeader</div><div class="info"><a href="#s_fn_FakeResponseWriter.WriteHeader">Back</a><p>In <code>/home/ubuntu/.go_project/src/github.com/TF2Stadium/Helen/controllers/socket/internal/handler/admin.go</code>:</p></div><table class="listing">
<tr><td>25</td><td><code><pre>func (f FakeResponseWriter) WriteHeader(int) {}</pre></code></td></tr></table>

<!-- Can be parsed by external script
PACKAGE:github.com/TF2Stadium/Helen/controllers/socket/internal/handler DONE:29.59
-->

<div id="summaryWrapper"><div class="package">github.com/TF2Stadium/Helen/controllers/socket/internal/handler</div>
<div id="totalcov">29.59%</div>
</div>
    </body>
